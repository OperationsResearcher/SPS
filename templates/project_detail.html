{% extends "base.html" %}

{% block title %}{{ project.name }} - Proje Detay{% endblock %}

{% block breadcrumb %}
<a href="{{ url_for('main.dashboard') }}">Ana Sayfa</a> / 
<a href="{{ url_for('main.projeler') }}">Proje YÃ¶netimi</a> / {{ project.name }}
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- Ãœst BaÅŸlÄ±k: Proje AdÄ±, Tarihler ve Ä°lerleme -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-primary text-white">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h4 class="mb-0">
                        <i class="fas fa-project-diagram me-2"></i>{{ project.name }}
                    </h4>
                    {% if project.description %}
                    <p class="mb-0 mt-2 small">{{ project.description }}</p>
                    {% endif %}
                </div>
                <div class="col-md-4 text-end">
                    {% if project.start_date and project.end_date %}
                    <div class="small">
                        <i class="fas fa-calendar-alt me-1"></i>
                        {{ project.start_date.strftime('%d.%m.%Y') }} - {{ project.end_date.strftime('%d.%m.%Y') }}
                    </div>
                    {% endif %}
                    <div class="mt-1">
                        <a class="text-white text-decoration-none small" href="{{ url_for('main.strategy_project_detail', id=project.id) }}">
                            <i class="fas fa-chart-line me-1"></i>Stratejik analiz
                        </a>
                    </div>
                    <div class="mt-2">
                        <span class="badge bg-{{ 'success' if project.priority == 'DÃ¼ÅŸÃ¼k' else 'warning' if project.priority == 'Orta' else 'danger' }}">
                            {{ project.priority }}
                        </span>
                    </div>
                    <div class="btn-group btn-group-sm mt-3" role="group" aria-label="Planlama gÃ¶rÃ¼nÃ¼mleri">
                        <a class="btn btn-outline-light" href="{{ url_for('main.project_kanban', project_id=project.id) }}">
                            <i class="fas fa-columns me-1"></i>Kanban
                        </a>
                        <a class="btn btn-outline-light" href="{{ url_for('main.project_calendar', project_id=project.id) }}">
                            <i class="fas fa-calendar-day me-1"></i>Takvim
                        </a>
                        <a class="btn btn-outline-light" href="{{ url_for('main.project_gantt', project_id=project.id) }}">
                            <i class="fas fa-chart-gantt me-1"></i>Gantt
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Proje AraÃ§larÄ± BÃ¶lÃ¼mÃ¼ -->
    <div class="card mb-4 shadow-sm border-top border-5 border-primary">
        <div class="card-header bg-light">
            <h5 class="mb-0">
                <i class="fas fa-toolbox text-primary me-2"></i>Proje AraÃ§larÄ±
            </h5>
            <p class="text-muted small mt-2 mb-0">Planlama, yÃ¶netim, otomasyon ve raporlama araÃ§larÄ±na eriÅŸin</p>
        </div>
        <div class="card-body">
            <div class="row g-3">
                <!-- CPM Analizi -->
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="position-relative">
                        <button class="btn btn-sm btn-light position-absolute top-0 end-0 m-2 tool-info-btn" 
                                onclick="showToolInfo('cpm')" style="z-index: 10;">
                            <i class="fas fa-info-circle text-primary"></i>
                        </button>
                        <a href="{{ url_for('main.project_cpm', project_id=project.id) }}" class="text-decoration-none">
                            <div class="card h-100 tool-card border-0 shadow-sm transition-all">
                                <div class="card-body text-center">
                                    <div class="tool-icon mb-3">
                                        <i class="fas fa-project-diagram fa-2x text-primary"></i>
                                    </div>
                                    <h6 class="card-title">CPM Analizi</h6>
                                    <p class="card-text small text-muted">Kritik yol ve gÃ¶rev baÄŸÄ±mlÄ±lÄ±klarÄ±</p>
                                    <span class="badge bg-primary">Planlama</span>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- RAID YÃ¶netimi -->
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="position-relative">
                        <button class="btn btn-sm btn-light position-absolute top-0 end-0 m-2 tool-info-btn" 
                                onclick="showToolInfo('raid')" style="z-index: 10;">
                            <i class="fas fa-info-circle text-primary"></i>
                        </button>
                        <a href="{{ url_for('main.project_raid', project_id=project.id) }}" class="text-decoration-none">
                            <div class="card h-100 tool-card border-0 shadow-sm transition-all">
                                <div class="card-body text-center">
                                    <div class="tool-icon mb-3">
                                        <i class="fas fa-shield-alt fa-2x text-danger"></i>
                                    </div>
                                    <h6 class="card-title">RAID YÃ¶netimi</h6>
                                    <p class="card-text small text-muted">Risk, varsayÄ±m, sorun, baÄŸÄ±mlÄ±lÄ±k</p>
                                    <span class="badge bg-danger">Risk</span>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- SLA TanÄ±mlarÄ± -->
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="position-relative">
                        <button class="btn btn-sm btn-light position-absolute top-0 end-0 m-2 tool-info-btn" 
                                onclick="showToolInfo('sla')" style="z-index: 10;">
                            <i class="fas fa-info-circle text-primary"></i>
                        </button>
                        <a href="{{ url_for('main.project_sla', project_id=project.id) }}" class="text-decoration-none">
                            <div class="card h-100 tool-card border-0 shadow-sm transition-all">
                                <div class="card-body text-center">
                                    <div class="tool-icon mb-3">
                                        <i class="fas fa-clock fa-2x text-warning"></i>
                                    </div>
                                    <h6 class="card-title">SLA TanÄ±mlarÄ±</h6>
                                    <p class="card-text small text-muted">GÃ¶rev tamamlanma hedefleri</p>
                                    <span class="badge bg-warning text-dark">YÃ¶netim</span>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Kapasite Planlama -->
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="position-relative">
                        <button class="btn btn-sm btn-light position-absolute top-0 end-0 m-2 tool-info-btn" 
                                onclick="showToolInfo('capacity')" style="z-index: 10;">
                            <i class="fas fa-info-circle text-primary"></i>
                        </button>
                        <a href="{{ url_for('main.project_capacity', project_id=project.id) }}" class="text-decoration-none">
                            <div class="card h-100 tool-card border-0 shadow-sm transition-all">
                                <div class="card-body text-center">
                                    <div class="tool-icon mb-3">
                                        <i class="fas fa-users-cog fa-2x text-success"></i>
                                    </div>
                                    <h6 class="card-title">Kapasite Planlama</h6>
                                    <p class="card-text small text-muted">Ekip kapasite yÃ¶netimi</p>
                                    <span class="badge bg-success">Kaynaklar</span>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Baseline Takibi -->
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="position-relative">
                        <button class="btn btn-sm btn-light position-absolute top-0 end-0 m-2 tool-info-btn" 
                                onclick="showToolInfo('baseline')" style="z-index: 10;">
                            <i class="fas fa-info-circle text-primary"></i>
                        </button>
                        <a href="{{ url_for('main.project_baseline', project_id=project.id) }}" class="text-decoration-none">
                            <div class="card h-100 tool-card border-0 shadow-sm transition-all">
                                <div class="card-body text-center">
                                    <div class="tool-icon mb-3">
                                        <i class="fas fa-chart-bar fa-2x text-info"></i>
                                    </div>
                                    <h6 class="card-title">Baseline Takibi</h6>
                                    <p class="card-text small text-muted">Planlanan vs GerÃ§ek analiz</p>
                                    <span class="badge bg-info">Analiz</span>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- BaÄŸÄ±mlÄ±lÄ±k Matrisi -->
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="position-relative">
                        <button class="btn btn-sm btn-light position-absolute top-0 end-0 m-2 tool-info-btn" 
                                onclick="showToolInfo('dependency')" style="z-index: 10;">
                            <i class="fas fa-info-circle text-primary"></i>
                        </button>
                        <a href="{{ url_for('main.project_dependency_matrix', project_id=project.id) }}" class="text-decoration-none">
                            <div class="card h-100 tool-card border-0 shadow-sm transition-all">
                                <div class="card-body text-center">
                                    <div class="tool-icon mb-3">
                                        <i class="fas fa-sitemap fa-2x text-primary"></i>
                                    </div>
                                    <h6 class="card-title">BaÄŸÄ±mlÄ±lÄ±k Matrisi</h6>
                                    <p class="card-text small text-muted">GÃ¶rev iliÅŸkileri ve baÄŸlantÄ±larÄ±</p>
                                    <span class="badge bg-primary">Planlama</span>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Kural Motoru -->
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="position-relative">
                        <button class="btn btn-sm btn-light position-absolute top-0 end-0 m-2 tool-info-btn" 
                                onclick="showToolInfo('rules')" style="z-index: 10;">
                            <i class="fas fa-info-circle text-primary"></i>
                        </button>
                        <a href="{{ url_for('main.project_rules', project_id=project.id) }}" class="text-decoration-none">
                            <div class="card h-100 tool-card border-0 shadow-sm transition-all">
                                <div class="card-body text-center">
                                    <div class="tool-icon mb-3">
                                        <i class="fas fa-cogs fa-2x text-success"></i>
                                    </div>
                                    <h6 class="card-title">Kural Motoru</h6>
                                    <p class="card-text small text-muted">Otomatik aksiyonlar ve tetikleyiciler</p>
                                    <span class="badge bg-success">Otomasyon</span>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Entegrasyonlar -->
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="position-relative">
                        <button class="btn btn-sm btn-light position-absolute top-0 end-0 m-2 tool-info-btn" 
                                onclick="showToolInfo('integrations')" style="z-index: 10;">
                            <i class="fas fa-info-circle text-primary"></i>
                        </button>
                        <a href="{{ url_for('main.project_integrations', project_id=project.id) }}" class="text-decoration-none">
                            <div class="card h-100 tool-card border-0 shadow-sm transition-all">
                                <div class="card-body text-center">
                                    <div class="tool-icon mb-3">
                                        <i class="fas fa-plug fa-2x text-info"></i>
                                    </div>
                                    <h6 class="card-title">Entegrasyonlar</h6>
                                    <p class="card-text small text-muted">Slack, Teams, Outlook webhook'larÄ±</p>
                                    <span class="badge bg-info">Otomasyon</span>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Tekrarlayan GÃ¶revler -->
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="position-relative">
                        <button class="btn btn-sm btn-light position-absolute top-0 end-0 m-2 tool-info-btn" 
                                onclick="showToolInfo('recurring')" style="z-index: 10;">
                            <i class="fas fa-info-circle text-primary"></i>
                        </button>
                        <a href="{{ url_for('main.project_recurring', project_id=project.id) }}" class="text-decoration-none">
                            <div class="card h-100 tool-card border-0 shadow-sm transition-all">
                                <div class="card-body text-center">
                                    <div class="tool-icon mb-3">
                                        <i class="fas fa-redo fa-2x text-success"></i>
                                    </div>
                                    <h6 class="card-title">Tekrarlayan GÃ¶revler</h6>
                                    <p class="card-text small text-muted">Cron temelli otomatik gÃ¶rev oluÅŸturma</p>
                                    <span class="badge bg-success">Otomasyon</span>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Ã‡alÄ±ÅŸma GÃ¼nleri -->
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="position-relative">
                        <button class="btn btn-sm btn-light position-absolute top-0 end-0 m-2 tool-info-btn" 
                                onclick="showToolInfo('workdays')" style="z-index: 10;">
                            <i class="fas fa-info-circle text-primary"></i>
                        </button>
                        <a href="{{ url_for('main.project_workdays', project_id=project.id) }}" class="text-decoration-none">
                            <div class="card h-100 tool-card border-0 shadow-sm transition-all">
                                <div class="card-body text-center">
                                    <div class="tool-icon mb-3">
                                        <i class="fas fa-calendar-check fa-2x text-secondary"></i>
                                    </div>
                                    <h6 class="card-title">Ã‡alÄ±ÅŸma GÃ¼nleri</h6>
                                    <p class="card-text small text-muted">Tatil ve Ã§alÄ±ÅŸma gÃ¼nÃ¼ yÃ¶netimi</p>
                                <span class="badge bg-secondary">YÃ¶netim</span>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
        <div class="card-body">
            <!-- Ä°lerleme Ã‡ubuÄŸu -->
            <div class="mb-2">
                <div class="d-flex justify-content-between mb-1">
                    <small class="text-muted">Proje Ä°lerlemesi</small>
                    <small class="text-muted" id="progressPercentage">0%</small>
                </div>
                <div class="progress" style="height: 25px;">
                    <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" 
                         role="progressbar" 
                         id="projectProgressBar"
                         style="width: 0%"
                         aria-valuenow="0" 
                         aria-valuemin="0" 
                         aria-valuemax="100">
                    </div>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card shadow-sm">
                        <div class="card-header bg-light">
                            <strong>Burnup</strong>
                        </div>
                        <div class="card-body"><canvas id="burnupChart"></canvas></div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card shadow-sm">
                        <div class="card-header bg-light">
                            <strong>Burndown</strong>
                        </div>
                        <div class="card-body"><canvas id="burndownChart"></canvas></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ana Grid: Sol (8) ve SaÄŸ (4) Kolon -->
    <div class="row">
        <!-- Sol Kolon: 8 birim -->
        <div class="col-md-8">
            <!-- Proje Takvimi (Gantt) -->
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-calendar-alt me-2"></i>Proje Takvimi (Gantt)
                    </h6>
                </div>
                <div class="card-body">
                    <div class="text-center py-5">
                        <i class="fas fa-chart-gantt fa-3x text-muted mb-3"></i>
                        <p class="text-muted">Gantt ÅŸemasÄ± yakÄ±nda eklenecek</p>
                        <p class="small text-muted">Proje gÃ¶revlerinin zaman Ã§izelgesi burada gÃ¶rÃ¼ntÃ¼lenecek</p>
                    </div>
                </div>
            </div>

            <!-- Faaliyetler Listesi -->
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">
                        <i class="fas fa-tasks me-2"></i>Faaliyetler Listesi
                    </h6>
                    {% if user_project_role in ['manager', 'member'] %}
                    <a class="btn btn-light btn-sm" href="{{ url_for('main.gorev_yeni', project_id=project.id) }}">
                        <i class="fas fa-plus me-1"></i>GÃ¶rev Ekle
                    </a>
                    {% endif %}
                </div>
                <div class="card-body">
                    <div id="tasksListContainer">
                        <div class="text-center py-3">
                            <div class="spinner-border spinner-border-sm" role="status"></div>
                            <p class="text-muted small mt-2">GÃ¶revler yÃ¼kleniyor...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SaÄŸ Kolon: 4 birim -->
        <div class="col-md-4">
            <!-- Proje KÃ¼nyesi -->
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-info-circle me-2"></i>Proje KÃ¼nyesi
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <strong>Proje YÃ¶neticisi:</strong><br>
                        {% if project.manager %}
                        <span class="text-muted">
                            <i class="fas fa-user me-1"></i>
                            {{ project.manager.first_name }} {{ project.manager.last_name }}
                        </span>
                        {% else %}
                        <span class="text-muted">AtanmamÄ±ÅŸ</span>
                        {% endif %}
                    </div>
                    <div class="mb-3">
                        <strong>OluÅŸturulma Tarihi:</strong><br>
                        <span class="text-muted">
                            {{ project.created_at.strftime('%d.%m.%Y %H:%M') if project.created_at else '-' }}
                        </span>
                    </div>
                    <div class="mb-3">
                        <strong>Durum:</strong><br>
                        <span class="badge bg-{{ 'success' if project.is_archived else 'primary' }}">
                            {{ 'ArÅŸivlendi' if project.is_archived else 'Aktif' }}
                        </span>
                    </div>
                    {% if project.members %}
                    <div class="mb-3">
                        <strong>Ãœyeler:</strong><br>
                        <small class="text-muted">{{ project.members|length }} kiÅŸi</small>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Risk IsÄ± HaritasÄ± -->
            <div class="card mb-4 shadow-sm border-left-danger">
                <div class="card-header bg-danger text-white d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">
                        <i class="fas fa-exclamation-triangle me-2"></i>Risk IsÄ± HaritasÄ±
                    </h6>
                    <button class="btn btn-light btn-sm" onclick="showAddRiskModal()">
                        <i class="fas fa-plus me-1"></i>Risk Ekle
                    </button>
                </div>
                <div class="card-body">
                    <div id="riskHeatmapContainer">
                        <div class="text-center py-3">
                            <div class="spinner-border spinner-border-sm" role="status"></div>
                            <p class="text-muted small mt-2">Riskler yÃ¼kleniyor...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI SimÃ¼lasyon Butonu -->
            <div class="card mt-4 shadow-sm border-left-warning">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-robot me-2"></i>AI SimÃ¼lasyon
                    </h5>
                    <p class="card-text small">Proje gecikirse ne olur? OlasÄ± senaryolarÄ± analiz et.</p>
                    <button class="btn btn-warning btn-block w-100" onclick="showWhatIfModal()">
                        <i class="fas fa-chart-line me-2"></i>What-If SimÃ¼lasyonu BaÅŸlat
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const canEditTasks = {{ 'true' if user_project_role in ['manager', 'member'] else 'false' }};
const canDeleteTasks = {{ 'true' if user_project_role == 'manager' else 'false' }};

document.addEventListener('DOMContentLoaded', function() {
    // Ä°lerleme Ã§ubuÄŸunu gÃ¼ncelle
    updateProjectProgress();
    
    // GÃ¶revleri yÃ¼kle
    loadTasks();
    
    // Riskleri yÃ¼kle
    loadRisks();

    // Burnup/Burndown yÃ¼kle
    loadBurnCharts();
});

function updateProjectProgress() {
    // Basit bir ilerleme hesaplama (tamamlanan gÃ¶revler / toplam gÃ¶revler)
    fetch(`/api/projeler/{{ project.id }}/gorevler`)
        .then(response => response.json())
        .then(data => {
            if (data.success && data.gorevler) {
                const tasks = data.gorevler;
                const total = tasks.length;
                const completed = tasks.filter(t => t.status === 'TamamlandÄ±').length;
                const progress = total > 0 ? Math.round((completed / total) * 100) : 0;
                
                const progressBar = document.getElementById('projectProgressBar');
                const progressText = document.getElementById('progressPercentage');
                
                if (progressBar) {
                    progressBar.style.width = progress + '%';
                    progressBar.setAttribute('aria-valuenow', progress);
                }
                if (progressText) {
                    progressText.textContent = progress + '%';
                }
            }
        })
        .catch(err => console.error('Progress update error:', err));
}

async function loadBurnCharts() {
    try {
        const res = await fetch('/api/projeler/{{ project.id }}/burn');
        const data = await res.json();
        if (!data.success) throw new Error(data.message || 'Grafikler yÃ¼klenemedi');
        const ctxUp = document.getElementById('burnupChart');
        const ctxDown = document.getElementById('burndownChart');
        const labels = (data.burnup || []).map(p => p.date);
        const burnupData = (data.burnup || []).map(p => p.done);
        const scopeData = (data.burnup || []).map(p => p.scope);
        const burndownData = (data.burndown || []).map(p => p.remaining);

        if (ctxUp) {
            new Chart(ctxUp, {
                type: 'line',
                data: {
                    labels,
                    datasets: [
                        { label: 'Tamamlanan', data: burnupData, borderColor: '#2ecc71', tension: 0.2 },
                        { label: 'Kapsam', data: scopeData, borderColor: '#95a5a6', borderDash: [4,4], tension: 0 }
                    ]
                },
                options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
            });
        }
        if (ctxDown) {
            new Chart(ctxDown, {
                type: 'line',
                data: {
                    labels,
                    datasets: [
                        { label: 'Kalan iÅŸ', data: burndownData, borderColor: '#e67e22', tension: 0.2 },
                        { label: 'Kapsam', data: scopeData, borderColor: '#95a5a6', borderDash: [4,4], tension: 0 }
                    ]
                },
                options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
            });
        }
    } catch (e) {
        if (window.showToast) showToast('error', e.message || 'Burn grafikleri yÃ¼klenemedi', 'Hata');
    }
}

function loadTasks() {
    fetch(`/api/projeler/{{ project.id }}/gorevler`)
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('tasksListContainer');
            if (data.success && data.gorevler) {
                const tasks = data.gorevler;
                if (tasks.length === 0) {
                    container.innerHTML = '<p class="text-muted text-center">HenÃ¼z gÃ¶rev eklenmemiÅŸ</p>';
                } else {
                    let html = '<div class="list-group">';
                    tasks.forEach(task => {
                        const statusClass = {
                            'TamamlandÄ±': 'success',
                            'Devam Ediyor': 'primary',
                            'YapÄ±lacak': 'secondary',
                            'Beklemede': 'warning'
                        }[task.status] || 'secondary';
                        
                        const isCompleted = task.status === 'TamamlandÄ±';
                        const canComplete = canEditTasks && !isCompleted && (task.status === 'YapÄ±lacak' || task.status === 'Devam Ediyor' || task.status === 'Beklemede');

                        const taskTitleHtml = canEditTasks
                            ? `<a href="/projeler/{{ project.id }}/gorevler/${task.id}" class="text-decoration-none">${task.title}</a>`
                            : `${task.title}`;
                        
                        html += `
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">${taskTitleHtml}</h6>
                                        ${task.description ? `<p class="mb-1 small text-muted">${task.description}</p>` : ''}
                                        <div class="d-flex align-items-center gap-3 mt-2">
                                            <small class="text-muted">
                                                <i class="fas fa-calendar me-1"></i>
                                                ${task.due_date || 'Tarih belirtilmemiÅŸ'}
                                            </small>
                                            ${task.assigned_to ? `<small class="text-muted">
                                                <i class="fas fa-user me-1"></i>
                                                ${task.assigned_to.first_name || ''} ${task.assigned_to.last_name || ''}
                                            </small>` : task.external_assignee_name ? `<small class="text-muted">
                                                <i class="fas fa-user me-1"></i>
                                                ${task.external_assignee_name}
                                            </small>` : task.assigned_to_id ? `<small class="text-muted">
                                                <i class="fas fa-user me-1"></i>
                                                Sorumlu: ${task.assigned_to_id}
                                            </small>` : ''}
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center gap-2 flex-wrap justify-content-end">
                                        <span class="badge bg-${statusClass}">${task.status}</span>
                                        ${canComplete ? `
                                            <button class="btn btn-success btn-sm" onclick="completeTask(${task.id})" title="GÃ¶revi Tamamla">
                                                <i class="fas fa-check"></i> Bitir
                                            </button>
                                        ` : isCompleted ? `
                                            <span class="badge bg-success">
                                                <i class="fas fa-check-circle"></i> TamamlandÄ±
                                            </span>
                                        ` : ''}

                                        ${canEditTasks ? `
                                            <a class="btn btn-outline-primary btn-sm" href="/projeler/{{ project.id }}/gorevler/${task.id}" title="DÃ¼zenle">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                        ` : ''}

                                        ${canDeleteTasks ? `
                                            <button class="btn btn-outline-danger btn-sm" onclick="deleteTask(${task.id})" title="Sil">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                    container.innerHTML = html;
                }
            } else {
                container.innerHTML = '<p class="text-danger text-center">GÃ¶revler yÃ¼klenirken hata oluÅŸtu</p>';
            }
        })
        .catch(err => {
            console.error('Tasks load error:', err);
            document.getElementById('tasksListContainer').innerHTML = 
                '<p class="text-danger text-center">GÃ¶revler yÃ¼klenirken hata oluÅŸtu</p>';
        });
}

function loadRisks() {
    fetch(`/api/projeler/{{ project.id }}/riskler`)
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('riskHeatmapContainer');
            if (data.success && data.risks) {
                const risks = data.risks;
                if (risks.length === 0) {
                    container.innerHTML = '<p class="text-muted text-center">HenÃ¼z risk eklenmemiÅŸ</p>';
                } else {
                    let html = '<div class="risk-grid">';
                    risks.forEach(risk => {
                        const score = risk.impact * risk.probability;
                        const level = score >= 20 ? 'Kritik' : score >= 12 ? 'YÃ¼ksek' : score >= 6 ? 'Orta' : 'DÃ¼ÅŸÃ¼k';
                        const color = score >= 20 ? 'danger' : score >= 12 ? 'warning' : score >= 6 ? 'info' : 'success';
                        
                        html += `
                            <div class="card mb-2 border-${color}">
                                <div class="card-body p-2">
                                    <h6 class="card-title mb-1 small">${risk.title}</h6>
                                    <span class="badge bg-${color}">${level} (${score})</span>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                    container.innerHTML = html;
                }
            } else {
                container.innerHTML = '<p class="text-muted text-center">Riskler yÃ¼klenirken hata oluÅŸtu</p>';
            }
        })
        .catch(err => {
            console.error('Risks load error:', err);
            document.getElementById('riskHeatmapContainer').innerHTML = 
                '<p class="text-muted text-center">Riskler yÃ¼klenirken hata oluÅŸtu</p>';
        });
}

function showWhatIfModal() {
    // Modal'Ä± gÃ¶ster
    const modal = new bootstrap.Modal(document.getElementById('whatIfModal'));
    modal.show();
    
    // Ä°Ã§eriÄŸi yÃ¼kle
    const contentDiv = document.getElementById('whatIfContent');
    contentDiv.innerHTML = '<div class="text-center py-4"><i class="fas fa-spinner fa-spin fa-3x text-muted"></i><p class="mt-2">Senaryolar hesaplanÄ±yor...</p></div>';
    
    // URL'den project ID'yi al
    const projectId = window.location.pathname.split('/').pop();
    
    // API'den simÃ¼lasyon verilerini al
    fetch(`/api/project/${projectId}/simulate`)
        .then(response => response.json())
        .then(data => {
            let htmlContent = `<div class="alert alert-${data.risk_level === 'high' ? 'danger' : data.risk_level === 'medium' ? 'warning' : 'info'}">
                                  <strong><i class="fas fa-exclamation-triangle me-2"></i>Tespit:</strong> ${data.summary}
                                </div>
                                <h6 class="mt-3"><i class="fas fa-search me-2"></i>OlasÄ± Senaryolar:</h6>
                                <ul class="list-group mb-3">`;
            
            data.scenarios.forEach(s => {
                htmlContent += `<li class="list-group-item d-flex justify-content-between align-items-center">
                                  <div>
                                      <strong>${s.description}</strong>
                                  </div>
                                  <span class="badge bg-primary rounded-pill">${s.impact}</span>
                                </li>`;
            });
            
            htmlContent += `</ul>
                            <h6 class="mt-3"><i class="fas fa-lightbulb me-2"></i>Yapay Zeka Ã–nerisi:</h6>
                            <div class="alert alert-info">
                                <p class="mb-0">${data.recommendation}</p>
                            </div>`;
            
            contentDiv.innerHTML = htmlContent;
        })
        .catch(err => {
            console.error('SimÃ¼lasyon hatasÄ±:', err);
            contentDiv.innerHTML = '<div class="alert alert-danger"><i class="fas fa-exclamation-circle me-2"></i>Analiz sÄ±rasÄ±nda hata oluÅŸtu. LÃ¼tfen tekrar deneyin.</div>';
        });
}

async function deleteTask(taskId) {
    if (!canDeleteTasks) return;
    if (!confirm('Bu gÃ¶revi silmek istediÄŸinize emin misiniz?')) return;

    try {
        const response = await fetch(`/api/projeler/{{ project.id }}/gorevler/${taskId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('meta[name=csrf-token]')?.content || ''
            }
        });
        const result = await response.json();
        if (result.success) {
            loadTasks();
            updateProjectProgress();
            showToast('success', 'GÃ¶rev silindi.', 'BaÅŸarÄ±lÄ±');
        } else {
            showToast('error', result.message || 'GÃ¶rev silinemedi', 'Hata');
        }
    } catch (e) {
        console.error('GÃ¶rev silme hatasÄ±:', e);
        showToast('error', 'GÃ¶rev silinirken bir hata oluÅŸtu.', 'Hata');
    }
}

function showAddRiskModal() {
    showToast('info', 'Risk ekleme Ã¶zelliÄŸi yakÄ±nda eklenecek', 'Bilgi');
}

function completeTask(taskId) {
    if(!confirm('Bu gÃ¶revi tamamlamak istediÄŸinize emin misiniz?')) return;
    
    fetch(`/api/task/${taskId}/complete`, { 
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
        .then(res => res.json())
        .then(data => {
            if(data.success) {
                showToast('success', 'GÃ¶rev tamamlandÄ±. Ä°lerleme gÃ¼ncelleniyor...', 'BaÅŸarÄ±lÄ±');
                // Ä°lerleme Ã§ubuÄŸunu gÃ¼ncelle
                if(data.new_progress !== undefined) {
                    const progressBar = document.getElementById('projectProgressBar');
                    const progressText = document.getElementById('progressPercentage');
                    if(progressBar) {
                        progressBar.style.width = data.new_progress + '%';
                        progressBar.setAttribute('aria-valuenow', data.new_progress);
                    }
                    if(progressText) {
                        progressText.textContent = data.new_progress + '%';
                    }
                }
                // GÃ¶rev listesini yenile
                loadTasks();
            } else {
                showToast('error', data.message || 'GÃ¶rev tamamlanÄ±rken bir hata oluÅŸtu', 'Hata');
            }
        })
        .catch(err => {
            console.error('GÃ¶rev tamamlama hatasÄ±:', err);
            showToast('error', 'GÃ¶rev tamamlanÄ±rken bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.', 'Hata');
        });
}
</script>

<!-- What-If SimÃ¼lasyon Modal -->
<div class="modal fade" id="whatIfModal" tabindex="-1" role="dialog" aria-labelledby="whatIfModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-warning text-white">
                <h5 class="modal-title" id="whatIfModalLabel">
                    <i class="fas fa-brain me-2"></i>AI Senaryo Analizi
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="whatIfContent">
                <div class="text-center py-4">
                    <i class="fas fa-spinner fa-spin fa-3x text-muted"></i>
                    <p class="mt-2 text-muted">Senaryolar hesaplanÄ±yor...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
                <button type="button" class="btn btn-primary" onclick="applyRecommendations()">
                    <i class="fas fa-check me-2"></i>Ã–nerileri Uygula
                </button>
            </div>
        </div>
    </div>
</div>

<!-- AraÃ§ Bilgilendirme Modal -->
<div class="modal fade" id="toolInfoModal" tabindex="-1" aria-labelledby="toolInfoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="toolInfoModalLabel">
                    <i class="fas fa-info-circle me-2"></i><span id="toolInfoTitle"></span>
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="toolInfoBody">
                <!-- Ä°Ã§erik dinamik yÃ¼klenecek -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
                <button type="button" class="btn btn-primary" id="toolInfoActionBtn">
                    <i class="fas fa-arrow-right me-2"></i>Araca Git
                </button>
            </div>
        </div>
    </div>
</div>

<style>
/* Proje AraÃ§larÄ± KartlarÄ± Stili */
.tool-card {
    cursor: pointer;
    transition: all 0.3s ease;
    border-bottom: 3px solid transparent;
}

.tool-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
    border-bottom-color: currentColor;
}

.tool-card .card-title {
    font-weight: 600;
    color: #333;
    margin: 0;
    font-size: 0.95rem;
}

.tool-card .card-text {
    line-height: 1.4;
    min-height: 2.8rem;
}

.tool-icon {
    transition: transform 0.3s ease;
}

.tool-card:hover .tool-icon {
    transform: scale(1.1);
}

.transition-all {
    transition: all 0.3s ease;
}

/* AraÃ§ kartlarÄ± renkli alt Ã§izgi */
.tool-card:nth-child(1),
.tool-card:nth-child(6) {
    border-left: 4px solid #0d6efd;
}

.tool-card:nth-child(2) {
    border-left: 4px solid #dc3545;
}

.tool-card:nth-child(3),
.tool-card:nth-child(10) {
    border-left: 4px solid #ffc107;
}

.tool-card:nth-child(4),
.tool-card:nth-child(7),
.tool-card:nth-child(9) {
    border-left: 4px solid #198754;
}

.tool-card:nth-child(5) {
    border-left: 4px solid #0dcaf0;
}

.tool-card:nth-child(8) {
    border-left: 4px solid #0dcaf0;
}
</style>

<script>
function applyRecommendations() {
    showToast('info', 'Ã–nerileri uygulama Ã¶zelliÄŸi yakÄ±nda eklenecek', 'Bilgi');
    // Ä°leride burada Ã¶nerileri otomatik uygulama mantÄ±ÄŸÄ± olacak
}

// AraÃ§ bilgilendirme sistemi
const toolInfoData = {
    cpm: {
        title: 'CPM (Critical Path Method) Analizi',
        icon: 'fas fa-project-diagram',
        color: 'primary',
        url: '{{ url_for("main.project_cpm", project_id=project.id) }}',
        sections: [
            {
                heading: 'NasÄ±l KullanÄ±lÄ±r?',
                content: `<ul class="list-unstyled">
                    <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>GÃ¶revler arasÄ±ndaki baÄŸÄ±mlÄ±lÄ±klarÄ± (predecessor/successor) tanÄ±mlayÄ±n</li>
                    <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>Her gÃ¶rev iÃ§in tahmini sÃ¼re girin</li>
                    <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>Sistem otomatik olarak kritik yolu hesaplar</li>
                    <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>Slack (boÅŸluk) zamanlarÄ±nÄ± gÃ¶rÃ¼ntÃ¼leyin</li>
                </ul>`
            },
            {
                heading: 'Ne SonuÃ§lar Elde Edersiniz?',
                content: `<ul class="list-unstyled">
                    <li class="mb-2"><i class="fas fa-chart-line text-info me-2"></i><strong>Kritik Yol:</strong> Projeyi geciktirecek gÃ¶revler kÄ±rmÄ±zÄ± ile iÅŸaretlenir</li>
                    <li class="mb-2"><i class="fas fa-clock text-warning me-2"></i><strong>Slack ZamanÄ±:</strong> Gecikme toleransÄ± olan gÃ¶revleri belirleyin</li>
                    <li class="mb-2"><i class="fas fa-calendar-alt text-primary me-2"></i><strong>Erken/GeÃ§ BaÅŸlangÄ±Ã§:</strong> Her gÃ¶rev iÃ§in optimal zaman penceresi</li>
                    <li class="mb-2"><i class="fas fa-exclamation-triangle text-danger me-2"></i><strong>Bottleneck Tespiti:</strong> DarboÄŸaz gÃ¶revleri belirleyin</li>
                </ul>`
            },
            {
                heading: 'Proje YÃ¶netimine KatkÄ±sÄ±',
                content: `<div class="alert alert-success mb-0">
                    <p class="mb-2"><strong>ğŸ¯ Risk Azaltma:</strong> Kritik gÃ¶revlere odaklanarak gecikmeler Ã¶nlenir</p>
                    <p class="mb-2"><strong>ğŸ“Š Kaynak Optimizasyonu:</strong> Slack zamanÄ± olan gÃ¶revlerde esneklik saÄŸlar</p>
                    <p class="mb-2"><strong>â±ï¸ GerÃ§ekÃ§i Planlama:</strong> En kÄ±sa proje sÃ¼resini bilimsel olarak hesaplar</p>
                    <p class="mb-0"><strong>ğŸ” Ã–nceliklendirme:</strong> Hangi gÃ¶revlerin geciktirilmeyeceÄŸini net gÃ¶sterir</p>
                </div>`
            }
        ]
    },
    raid: {
        title: 'RAID YÃ¶netimi',
        icon: 'fas fa-shield-alt',
        color: 'danger',
        url: '{{ url_for("main.project_raid", project_id=project.id) }}',
        sections: [
            {
                heading: 'NasÄ±l KullanÄ±lÄ±r?',
                content: `<ul class="list-unstyled">
                    <li class="mb-2"><i class="fas fa-exclamation-triangle text-danger me-2"></i><strong>Risks (Riskler):</strong> OlasÄ±lÄ±k (1-5) ve etki (1-5) puanlayÄ±n, azaltma stratejisi belirleyin</li>
                    <li class="mb-2"><i class="fas fa-question-circle text-info me-2"></i><strong>Assumptions (VarsayÄ±mlar):</strong> DoÄŸrulama tarihi ve notlarla varsayÄ±mlarÄ±nÄ±zÄ± kaydedin</li>
                    <li class="mb-2"><i class="fas fa-bug text-warning me-2"></i><strong>Issues (Sorunlar):</strong> Aciliyet seviyesi (DÃ¼ÅŸÃ¼k/Orta/YÃ¼ksek/Kritik) ile aktif sorunlarÄ± takip edin</li>
                    <li class="mb-2"><i class="fas fa-link text-primary me-2"></i><strong>Dependencies (BaÄŸÄ±mlÄ±lÄ±klar):</strong> DÄ±ÅŸ baÄŸÄ±mlÄ±lÄ±klarÄ± ve gÃ¶rev iliÅŸkilerini (FS/SS/FF/SF) yÃ¶netin</li>
                </ul>`
            },
            {
                heading: 'Ne SonuÃ§lar Elde Edersiniz?',
                content: `<ul class="list-unstyled">
                    <li class="mb-2"><i class="fas fa-chart-pie text-danger me-2"></i><strong>Risk Skoru:</strong> OlasÄ±lÄ±k Ã— Etki = toplam risk deÄŸeri (max 25)</li>
                    <li class="mb-2"><i class="fas fa-list-check text-success me-2"></i><strong>Ã–nceliklendirme:</strong> En kritik riskleri skor sÄ±ralamasÄ±yla gÃ¶rebilirsiniz</li>
                    <li class="mb-2"><i class="fas fa-bell text-warning me-2"></i><strong>VarsayÄ±m UyarÄ±larÄ±:</strong> DoÄŸrulama tarihi geÃ§miÅŸ varsayÄ±mlar vurgulanÄ±r</li>
                    <li class="mb-2"><i class="fas fa-fire text-danger me-2"></i><strong>Acil Sorunlar:</strong> Kritik ve yÃ¼ksek aciliyetli sorunlar Ã¶ne Ã§Ä±kar</li>
                </ul>`
            },
            {
                heading: 'Proje YÃ¶netimine KatkÄ±sÄ±',
                content: `<div class="alert alert-danger mb-0">
                    <p class="mb-2"><strong>ğŸ›¡ï¸ Proaktif Koruma:</strong> Riskler kriz olmadan Ã¶nce yÃ¶netilir</p>
                    <p class="mb-2"><strong>ğŸ“‹ ToplantÄ± VerimliliÄŸi:</strong> TÃ¼m riskler, sorunlar, varsayÄ±mlar tek ekranda</p>
                    <p class="mb-2"><strong>ğŸ¯ YanlÄ±ÅŸ VarsayÄ±m Engeli:</strong> DoÄŸrulanmamÄ±ÅŸ varsayÄ±mlar planÄ± Ã§Ã¼rÃ¼tmeden yakalanÄ±r</p>
                    <p class="mb-0"><strong>ğŸ”— BaÄŸÄ±mlÄ±lÄ±k ÅeffaflÄ±ÄŸÄ±:</strong> Blokaj noktalarÄ± ve dÄ±ÅŸ faktÃ¶rler gÃ¶rÃ¼nÃ¼r olur</p>
                </div>`
            }
        ]
    },
    sla: {
        title: 'SLA (Service Level Agreement) TanÄ±mlarÄ±',
        icon: 'fas fa-clock',
        color: 'warning',
        url: '{{ url_for("main.project_sla", project_id=project.id) }}',
        sections: [
            {
                heading: 'NasÄ±l KullanÄ±lÄ±r?',
                content: `<ul class="list-unstyled">
                    <li class="mb-2"><i class="fas fa-tag text-primary me-2"></i>GÃ¶rev tiplerine gÃ¶re SLA kurallarÄ± oluÅŸturun (Bug, Feature, Task vb.)</li>
                    <li class="mb-2"><i class="fas fa-hourglass-half text-warning me-2"></i>Hedef tamamlanma sÃ¼resini (saat/gÃ¼n) belirleyin</li>
                    <li class="mb-2"><i class="fas fa-bell text-danger me-2"></i>Otomatik uyarÄ± eÅŸikleri tanÄ±mlayÄ±n (%75, %90, %100)</li>
                    <li class="mb-2"><i class="fas fa-cog text-success me-2"></i>Ã–ncelik seviyelerine gÃ¶re farklÄ± SLA'lar atayÄ±n</li>
                </ul>`
            },
            {
                heading: 'Ne SonuÃ§lar Elde Edersiniz?',
                content: `<ul class="list-unstyled">
                    <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i><strong>SLA Uyum OranÄ±:</strong> Hedeflere uyum yÃ¼zdesi raporlanÄ±r</li>
                    <li class="mb-2"><i class="fas fa-exclamation-circle text-warning me-2"></i><strong>YaklaÅŸan Ä°hlaller:</strong> SÃ¼resi dolmak Ã¼zere olan gÃ¶revler vurgulanÄ±r</li>
                    <li class="mb-2"><i class="fas fa-times-circle text-danger me-2"></i><strong>Ä°hlal Analizi:</strong> SLA'yÄ± aÅŸan gÃ¶revler listelenir</li>
                    <li class="mb-2"><i class="fas fa-chart-bar text-info me-2"></i><strong>Performans Metrikleri:</strong> Ortalama tamamlanma sÃ¼releri grafiÄŸi</li>
                </ul>`
            },
            {
                heading: 'Proje YÃ¶netimine KatkÄ±sÄ±',
                content: `<div class="alert alert-warning mb-0">
                    <p class="mb-2"><strong>â° Zaman YÃ¶netimi:</strong> GÃ¶revler net tamamlanma hedefleriyle yÃ¶netilir</p>
                    <p class="mb-2"><strong>ğŸ“ˆ Performans Ä°zleme:</strong> Ekip ve bireysel SLA uyum oranlarÄ± Ã¶lÃ§Ã¼lÃ¼r</p>
                    <p class="mb-2"><strong>ğŸš¨ Erken UyarÄ±:</strong> Gecikme riski olan gÃ¶revler Ã¶nceden belirlenir</p>
                    <p class="mb-0"><strong>ğŸ¯ Kalite Garantisi:</strong> MÃ¼ÅŸteri/stakeholder beklentileri karÅŸÄ±lanÄ±r</p>
                </div>`
            }
        ]
    },
    capacity: {
        title: 'Kapasite Planlama',
        icon: 'fas fa-users-cog',
        color: 'success',
        url: '{{ url_for("main.project_capacity", project_id=project.id) }}',
        sections: [
            {
                heading: 'NasÄ±l KullanÄ±lÄ±r?',
                content: `<ul class="list-unstyled">
                    <li class="mb-2"><i class="fas fa-user text-primary me-2"></i>Ekip Ã¼yelerinin gÃ¼nlÃ¼k/haftalÄ±k Ã§alÄ±ÅŸma saatlerini tanÄ±mlayÄ±n</li>
                    <li class="mb-2"><i class="fas fa-calendar text-info me-2"></i>Tatil ve izin gÃ¼nlerini sisteme girin</li>
                    <li class="mb-2"><i class="fas fa-tasks text-warning me-2"></i>GÃ¶revlere tahmini efor (saat) atayÄ±n</li>
                    <li class="mb-2"><i class="fas fa-chart-gantt text-success me-2"></i>Zaman Ã§izelgesinde kaynak yÃ¼klenmesini gÃ¶rÃ¼ntÃ¼leyin</li>
                </ul>`
            },
            {
                heading: 'Ne SonuÃ§lar Elde Edersiniz?',
                content: `<ul class="list-unstyled">
                    <li class="mb-2"><i class="fas fa-tachometer-alt text-danger me-2"></i><strong>YÃ¼klenme OranÄ±:</strong> %0-100+ aralÄ±ÄŸÄ±nda kiÅŸi bazlÄ± kullanÄ±m</li>
                    <li class="mb-2"><i class="fas fa-exclamation-triangle text-warning me-2"></i><strong>AÅŸÄ±rÄ± YÃ¼klenme UyarÄ±sÄ±:</strong> %100'Ã¼ aÅŸan atamalar kÄ±rmÄ±zÄ± ile gÃ¶sterilir</li>
                    <li class="mb-2"><i class="fas fa-battery-quarter text-info me-2"></i><strong>BoÅŸ Kapasite:</strong> AtanmamÄ±ÅŸ zaman dilimlerini gÃ¶rÃ¼ntÃ¼leyin</li>
                    <li class="mb-2"><i class="fas fa-balance-scale text-success me-2"></i><strong>Kaynak Dengeleme:</strong> GÃ¶rev daÄŸÄ±lÄ±mÄ±nÄ± optimize edin</li>
                </ul>`
            },
            {
                heading: 'Proje YÃ¶netimine KatkÄ±sÄ±',
                content: `<div class="alert alert-success mb-0">
                    <p class="mb-2"><strong>ğŸ‘¥ Ekip SaÄŸlÄ±ÄŸÄ±:</strong> Burnout riski taÅŸÄ±yan kiÅŸileri Ã¶nceden tespit edersiniz</p>
                    <p class="mb-2"><strong>ğŸ“Š GerÃ§ekÃ§i Planlama:</strong> Kapasite Ã¼stÃ¼ iÅŸ atanmasÄ±nÄ± engellersiniz</p>
                    <p class="mb-2"><strong>ğŸ”„ Esnek Yeniden Atama:</strong> BoÅŸ kapasitedeki kiÅŸilere gÃ¶rev aktarÄ±labilir</p>
                    <p class="mb-0"><strong>ğŸ’° Maliyet Optimizasyonu:</strong> Kaynak israfÄ± Ã¶nlenir, verimlilik artar</p>
                </div>`
            }
        ]
    },
    baseline: {
        title: 'Baseline (Referans) Takibi',
        icon: 'fas fa-chart-bar',
        color: 'info',
        url: '{{ url_for("main.project_baseline", project_id=project.id) }}',
        sections: [
            {
                heading: 'NasÄ±l KullanÄ±lÄ±r?',
                content: `<ul class="list-unstyled">
                    <li class="mb-2"><i class="fas fa-save text-primary me-2"></i>Proje baÅŸlangÄ±cÄ±nda veya Ã¶nemli milestone'larda "Baseline Kaydet"</li>
                    <li class="mb-2"><i class="fas fa-calendar-check text-success me-2"></i>Kaydedilen baseline, o anki tÃ¼m gÃ¶rev tarih/efor bilgilerini dondurur</li>
                    <li class="mb-2"><i class="fas fa-chart-line text-warning me-2"></i>GerÃ§ek ilerleme ile planlanan (baseline) karÅŸÄ±laÅŸtÄ±rÄ±lÄ±r</li>
                    <li class="mb-2"><i class="fas fa-edit text-info me-2"></i>GÃ¶revler deÄŸiÅŸtikÃ§e sapma (variance) otomatik hesaplanÄ±r</li>
                </ul>`
            },
            {
                heading: 'Ne SonuÃ§lar Elde Edersiniz?',
                content: `<ul class="list-unstyled">
                    <li class="mb-2"><i class="fas fa-arrows-alt-h text-primary me-2"></i><strong>Tarih SapmasÄ±:</strong> Planlanan vs gerÃ§ek tarih farkÄ± (gÃ¼n)</li>
                    <li class="mb-2"><i class="fas fa-hourglass-end text-warning me-2"></i><strong>Efor SapmasÄ±:</strong> Tahmini vs harcanan efor farkÄ± (saat)</li>
                    <li class="mb-2"><i class="fas fa-percentage text-danger me-2"></i><strong>Sapma YÃ¼zdesi:</strong> +/- % olarak gÃ¶sterilir</li>
                    <li class="mb-2"><i class="fas fa-chart-area text-success me-2"></i><strong>Trend GrafiÄŸi:</strong> Zaman iÃ§inde sapmanÄ±n nasÄ±l deÄŸiÅŸtiÄŸi gÃ¶rÃ¼lÃ¼r</li>
                </ul>`
            },
            {
                heading: 'Proje YÃ¶netimine KatkÄ±sÄ±',
                content: `<div class="alert alert-info mb-0">
                    <p class="mb-2"><strong>ğŸ“ Tahmin DoÄŸruluÄŸu:</strong> Gelecek projeler iÃ§in daha iyi efor tahmini yaparsÄ±nÄ±z</p>
                    <p class="mb-2"><strong>ğŸ” Sapma Analizi:</strong> Neden gecikme/aÅŸma olduÄŸunu retrospektif inceleyebilirsiniz</p>
                    <p class="mb-2"><strong>ğŸ“Š YÃ¶netici Raporlama:</strong> "Plan vs GerÃ§ek" raporu stakeholder'lara sunulur</p>
                    <p class="mb-0"><strong>âš–ï¸ PMI Uyumluluk:</strong> PMBOK standartlarÄ±ndaki EVM (Earned Value Management) temelini oluÅŸturur</p>
                </div>`
            }
        ]
    },
    dependency: {
        title: 'BaÄŸÄ±mlÄ±lÄ±k Matrisi',
        icon: 'fas fa-sitemap',
        color: 'primary',
        url: '{{ url_for("main.project_dependency_matrix", project_id=project.id) }}',
        sections: [
            {
                heading: 'NasÄ±l KullanÄ±lÄ±r?',
                content: `<ul class="list-unstyled">
                    <li class="mb-2"><i class="fas fa-table text-primary me-2"></i>Matris formatÄ±nda satÄ±r = kaynak gÃ¶rev, sÃ¼tun = hedef gÃ¶rev</li>
                    <li class="mb-2"><i class="fas fa-link text-info me-2"></i>Ä°ki gÃ¶rev arasÄ±nda baÄŸÄ±mlÄ±lÄ±k varsa hÃ¼creye tÄ±klayÄ±n</li>
                    <li class="mb-2"><i class="fas fa-project-diagram text-success me-2"></i>GÃ¶rsel aÄŸ grafiÄŸi ile tÃ¼m baÄŸlantÄ±larÄ± gÃ¶rÃ¼ntÃ¼leyin</li>
                    <li class="mb-2"><i class="fas fa-search text-warning me-2"></i>DÃ¶ngÃ¼sel baÄŸÄ±mlÄ±lÄ±k (circular dependency) uyarÄ±larÄ± alÄ±n</li>
                </ul>`
            },
            {
                heading: 'Ne SonuÃ§lar Elde Edersiniz?',
                content: `<ul class="list-unstyled">
                    <li class="mb-2"><i class="fas fa-network-wired text-primary me-2"></i><strong>BaÄŸÄ±mlÄ±lÄ±k HaritasÄ±:</strong> Hangi gÃ¶revin hangi gÃ¶reve baÄŸlÄ± olduÄŸu netleÅŸir</li>
                    <li class="mb-2"><i class="fas fa-exclamation-triangle text-danger me-2"></i><strong>DÃ¶ngÃ¼ Tespiti:</strong> Aâ†’Bâ†’Câ†’A gibi kÄ±sÄ±r dÃ¶ngÃ¼ler yakalanÄ±r</li>
                    <li class="mb-2"><i class="fas fa-lock text-warning me-2"></i><strong>Blokaj NoktalarÄ±:</strong> Ã‡ok sayÄ±da gÃ¶revi bekleyen gÃ¶revler vurgulanÄ±r</li>
                    <li class="mb-2"><i class="fas fa-cubes text-info me-2"></i><strong>BaÄŸÄ±mlÄ±lÄ±k YoÄŸunluÄŸu:</strong> GÃ¶rev baÅŸÄ±na ortalama baÄŸlantÄ± sayÄ±sÄ±</li>
                </ul>`
            },
            {
                heading: 'Proje YÃ¶netimine KatkÄ±sÄ±',
                content: `<div class="alert alert-primary mb-0">
                    <p class="mb-2"><strong>ğŸ§© Kompleksite YÃ¶netimi:</strong> KarmaÅŸÄ±k projelerde iliÅŸkileri gÃ¶rsel olarak anlamlandÄ±rÄ±rsÄ±nÄ±z</p>
                    <p class="mb-2"><strong>ğŸš« DÃ¶ngÃ¼ Engelleme:</strong> MantÄ±ksal hatalar proje baÅŸlamadan dÃ¼zeltilir</p>
                    <p class="mb-2"><strong>âš¡ Paralel Ä°ÅŸ:</strong> BaÄŸÄ±mlÄ± olmayan gÃ¶revler eÅŸ zamanlÄ± yÃ¼rÃ¼tÃ¼lebilir</p>
                    <p class="mb-0"><strong>ğŸ¯ Kritik GÃ¶revler:</strong> En Ã§ok baÄŸÄ±mlÄ±lÄ±ÄŸa sahip gÃ¶revler Ã¶nceliklendirilir</p>
                </div>`
            }
        ]
    },
    rules: {
        title: 'Kural Motoru (Automation Engine)',
        icon: 'fas fa-cogs',
        color: 'success',
        url: '{{ url_for("main.project_rules", project_id=project.id) }}',
        sections: [
            {
                heading: 'NasÄ±l KullanÄ±lÄ±r?',
                content: `<ul class="list-unstyled">
                    <li class="mb-2"><i class="fas fa-bolt text-warning me-2"></i><strong>Tetikleyici (Trigger):</strong> "GÃ¶rev tamamlandÄ±", "Deadline yaklaÅŸtÄ±" gibi olaylar</li>
                    <li class="mb-2"><i class="fas fa-filter text-primary me-2"></i><strong>KoÅŸul (Condition):</strong> "EÄŸer Ã¶ncelik = YÃ¼ksek ise", "EÄŸer atama yapÄ±lmamÄ±ÅŸsa"</li>
                    <li class="mb-2"><i class="fas fa-play-circle text-success me-2"></i><strong>Aksiyon (Action):</strong> "Bildirim gÃ¶nder", "Durum deÄŸiÅŸtir", "Atama yap"</li>
                    <li class="mb-2"><i class="fas fa-toggle-on text-info me-2"></i>KuralÄ± aktif/pasif duruma getirebilirsiniz</li>
                </ul>`
            },
            {
                heading: 'Ne SonuÃ§lar Elde Edersiniz?',
                content: `<ul class="list-unstyled">
                    <li class="mb-2"><i class="fas fa-robot text-primary me-2"></i><strong>Otomatik Ä°ÅŸ AkÄ±ÅŸlarÄ±:</strong> Manuel mÃ¼dahale gerektirmeyen sÃ¼reÃ§ler</li>
                    <li class="mb-2"><i class="fas fa-bell text-warning me-2"></i><strong>AkÄ±llÄ± Bildirimler:</strong> Sadece gerekli durumlarda uyarÄ±</li>
                    <li class="mb-2"><i class="fas fa-exchange-alt text-info me-2"></i><strong>Durum Otomasyonu:</strong> GÃ¶revler otomatik statÃ¼ deÄŸiÅŸtirir (Ã¶r. "Test"â†’"TamamlandÄ±")</li>
                    <li class="mb-2"><i class="fas fa-history text-success me-2"></i><strong>Kural Ã‡alÄ±ÅŸtÄ±rma Logu:</strong> Hangi kuralÄ±n ne zaman tetiklendiÄŸini gÃ¶rÃ¼n</li>
                </ul>`
            },
            {
                heading: 'Proje YÃ¶netimine KatkÄ±sÄ±',
                content: `<div class="alert alert-success mb-0">
                    <p class="mb-2"><strong>â±ï¸ Zaman Tasarrufu:</strong> Tekrarlayan manuel iÅŸler otomatikleÅŸtirilir</p>
                    <p class="mb-2"><strong>ğŸ¯ TutarlÄ±lÄ±k:</strong> Kurallar her zaman aynÄ± ÅŸekilde uygulanÄ±r, insan hatasÄ± sÄ±fÄ±ra iner</p>
                    <p class="mb-2"><strong>ğŸ”” Proaktif YÃ¶netim:</strong> Sorun oluÅŸmadan Ã¶nce otomatik aksiyon alÄ±nÄ±r</p>
                    <p class="mb-0"><strong>ğŸ“ˆ Ã–lÃ§eklenebilirlik:</strong> 10 gÃ¶revde Ã§alÄ±ÅŸan sÃ¼reÃ§ 1000 gÃ¶revde de Ã§alÄ±ÅŸÄ±r</p>
                </div>`
            }
        ]
    },
    integrations: {
        title: 'Entegrasyonlar (Webhook & API)',
        icon: 'fas fa-plug',
        color: 'info',
        url: '{{ url_for("main.project_integrations", project_id=project.id) }}',
        sections: [
            {
                heading: 'NasÄ±l KullanÄ±lÄ±r?',
                content: `<ul class="list-unstyled">
                    <li class="mb-2"><i class="fab fa-slack text-purple me-2"></i><strong>Slack:</strong> Webhook URL'si ekleyin, gÃ¶rev gÃ¼ncellemeleri kanala dÃ¼ÅŸsÃ¼n</li>
                    <li class="mb-2"><i class="fab fa-microsoft text-primary me-2"></i><strong>MS Teams:</strong> Teams webhook URL'si ile bildirimleri Teams'e gÃ¶nderin</li>
                    <li class="mb-2"><i class="fas fa-envelope text-danger me-2"></i><strong>Email (Outlook/Gmail):</strong> SMTP ayarlarÄ± ile e-posta otomasyonu</li>
                    <li class="mb-2"><i class="fas fa-code text-success me-2"></i><strong>Custom Webhook:</strong> Kendi sisteminize JSON POST isteÄŸi gÃ¶nderin</li>
                </ul>`
            },
            {
                heading: 'Ne SonuÃ§lar Elde Edersiniz?',
                content: `<ul class="list-unstyled">
                    <li class="mb-2"><i class="fas fa-comments text-info me-2"></i><strong>GerÃ§ek ZamanlÄ± Bildirimler:</strong> TakÄ±mÄ±nÄ±z kullandÄ±ÄŸÄ± platformda anÄ±nda haberdar olur</li>
                    <li class="mb-2"><i class="fas fa-sync text-primary me-2"></i><strong>Ã‡ift YÃ¶nlÃ¼ Entegrasyon:</strong> (GeliÅŸmiÅŸ) Slack'ten komut gÃ¶ndererek gÃ¶rev durumu deÄŸiÅŸtirebilirsiniz</li>
                    <li class="mb-2"><i class="fas fa-chart-pie text-success me-2"></i><strong>Event Log:</strong> Hangi olayÄ±n hangi sisteme gÃ¶nderildiÄŸi kayÄ±t altÄ±nda</li>
                    <li class="mb-2"><i class="fas fa-shield-alt text-warning me-2"></i><strong>GÃ¼venlik:</strong> Webhook secret ile yetkisiz eriÅŸim engellenir</li>
                </ul>`
            },
            {
                heading: 'Proje YÃ¶netimine KatkÄ±sÄ±',
                content: `<div class="alert alert-info mb-0">
                    <p class="mb-2"><strong>ğŸ”— Ekosistem Entegrasyonu:</strong> KullandÄ±ÄŸÄ±nÄ±z diÄŸer araÃ§larla senkronize Ã§alÄ±ÅŸÄ±r</p>
                    <p class="mb-2"><strong>ğŸ“¢ Ä°letiÅŸim VerimliliÄŸi:</strong> Ekip "proje aracÄ±na girmeden" gÃ¼ncellemeleri gÃ¶rÃ¼r</p>
                    <p class="mb-2"><strong>ğŸš€ Ã–lÃ§eklenme:</strong> Webhook'larla binlerce kullanÄ±cÄ±ya anÄ±nda bildirim gÃ¶nderilir</p>
                    <p class="mb-0"><strong>ğŸ¤– Otomasyon Zinciri:</strong> Bir olay, baÅŸka sistemde tetikleyici olabilir (event-driven architecture)</p>
                </div>`
            }
        ]
    },
    recurring: {
        title: 'Tekrarlayan GÃ¶revler (Recurring Tasks)',
        icon: 'fas fa-redo',
        color: 'success',
        url: '{{ url_for("main.project_recurring", project_id=project.id) }}',
        sections: [
            {
                heading: 'NasÄ±l KullanÄ±lÄ±r?',
                content: `<ul class="list-unstyled">
                    <li class="mb-2"><i class="fas fa-calendar-alt text-primary me-2"></i>Cron ifadesi girin: <code>0 9 * * 1</code> (Her Pazartesi saat 09:00)</li>
                    <li class="mb-2"><i class="fas fa-file-alt text-info me-2"></i>Åablon gÃ¶rev tanÄ±mlayÄ±n (baÅŸlÄ±k, aÃ§Ä±klama, atama, Ã¶ncelik)</li>
                    <li class="mb-2"><i class="fas fa-clock text-warning me-2"></i>BaÅŸlangÄ±Ã§ ve bitiÅŸ tarihi belirleyin (veya sÃ¼resiz)</li>
                    <li class="mb-2"><i class="fas fa-toggle-on text-success me-2"></i>Aktif hale getirin; sistem otomatik gÃ¶rev oluÅŸturmaya baÅŸlar</li>
                </ul>`
            },
            {
                heading: 'Ne SonuÃ§lar Elde Edersiniz?',
                content: `<ul class="list-unstyled">
                    <li class="mb-2"><i class="fas fa-tasks text-primary me-2"></i><strong>Otomatik GÃ¶rev Ãœretimi:</strong> Belirlenen periyotta yeni gÃ¶revler sisteme eklenir</li>
                    <li class="mb-2"><i class="fas fa-history text-info me-2"></i><strong>OluÅŸturma GeÃ§miÅŸi:</strong> Hangi tekrardan kaÃ§ gÃ¶rev yaratÄ±ldÄ±ÄŸÄ± loglanÄ±r</li>
                    <li class="mb-2"><i class="fas fa-calendar-check text-success me-2"></i><strong>Esnek Zamanlama:</strong> GÃ¼nlÃ¼k, haftalÄ±k, aylÄ±k, custom cron destekler</li>
                    <li class="mb-2"><i class="fas fa-pause-circle text-warning me-2"></i><strong>Durdurma/Devam:</strong> Ä°stediÄŸiniz zaman tekrarÄ± durdurup tekrar baÅŸlatabilirsiniz</li>
                </ul>`
            },
            {
                heading: 'Proje YÃ¶netimine KatkÄ±sÄ±',
                content: `<div class="alert alert-success mb-0">
                    <p class="mb-2"><strong>ğŸ” Rutin Ä°ÅŸler:</strong> HaftalÄ±k rapor, aylÄ±k denetim gibi periyodik gÃ¶revleri unutmazsÄ±nÄ±z</p>
                    <p class="mb-2"><strong>â° Zaman YÃ¶netimi:</strong> AynÄ± gÃ¶revi her hafta manuel oluÅŸturma yÃ¼kÃ¼nden kurtulursunuz</p>
                    <p class="mb-2"><strong>ğŸ“Š TutarlÄ±lÄ±k:</strong> Åablon gÃ¶rev sayesinde her sefer aynÄ± standart uygulanÄ±r</p>
                    <p class="mb-0"><strong>ğŸ¯ Compliance:</strong> Yasal/dÃ¼zenleyici zorunlu periyodik gÃ¶revler asla atlanmaz</p>
                </div>`
            }
        ]
    },
    workdays: {
        title: 'Ã‡alÄ±ÅŸma GÃ¼nleri & Tatil YÃ¶netimi',
        icon: 'fas fa-calendar-check',
        color: 'secondary',
        url: '{{ url_for("main.project_workdays", project_id=project.id) }}',
        sections: [
            {
                heading: 'NasÄ±l KullanÄ±lÄ±r?',
                content: `<ul class="list-unstyled">
                    <li class="mb-2"><i class="fas fa-calendar text-primary me-2"></i>Resmi tatil gÃ¼nlerini takvime ekleyin (Ã¶rn. 1 Ocak, 23 Nisan)</li>
                    <li class="mb-2"><i class="fas fa-clock text-warning me-2"></i>GÃ¼nlÃ¼k Ã§alÄ±ÅŸma saatlerini tanÄ±mlayÄ±n (Ã¶rn. 09:00-18:00, 8 saat)</li>
                    <li class="mb-2"><i class="fas fa-business-time text-success me-2"></i>Hafta iÃ§i/hafta sonu kurallarÄ±nÄ± belirleyin</li>
                    <li class="mb-2"><i class="fas fa-user-clock text-info me-2"></i>KiÅŸi bazlÄ± Ã¶zel izin/tatil gÃ¼nleri girin</li>
                </ul>`
            },
            {
                heading: 'Ne SonuÃ§lar Elde Edersiniz?',
                content: `<ul class="list-unstyled">
                    <li class="mb-2"><i class="fas fa-calculator text-primary me-2"></i><strong>Net Ã‡alÄ±ÅŸma GÃ¼nÃ¼:</strong> Tatiller hariÃ§ gerÃ§ek iÅŸ gÃ¼n sayÄ±sÄ± hesaplanÄ±r</li>
                    <li class="mb-2"><i class="fas fa-calendar-times text-danger me-2"></i><strong>Deadline Ayarlama:</strong> GÃ¶rev bitiÅŸ tarihleri tatilleri atlayarak hesaplanÄ±r</li>
                    <li class="mb-2"><i class="fas fa-chart-line text-info me-2"></i><strong>Kapasite DÃ¼zeltmesi:</strong> Tatil gÃ¼nlerinde 0 kapasite olarak gÃ¶sterilir</li>
                    <li class="mb-2"><i class="fas fa-users text-success me-2"></i><strong>Ekip Takvimi:</strong> Kimin ne zaman izinde olduÄŸu gÃ¶rÃ¼nÃ¼r</li>
                </ul>`
            },
            {
                heading: 'Proje YÃ¶netimine KatkÄ±sÄ±',
                content: `<div class="alert alert-secondary mb-0">
                    <p class="mb-2"><strong>ğŸ“… GerÃ§ekÃ§i Planlama:</strong> Tatiller ve izinler gÃ¶z Ã¶nÃ¼ne alÄ±narak deadline belirlenir</p>
                    <p class="mb-2"><strong>ğŸŒ Global Projeler:</strong> FarklÄ± Ã¼lkelerin resmi tatilleri tek sistemde yÃ¶netilir</p>
                    <p class="mb-2"><strong>â³ Efor HesabÄ±:</strong> CPM ve baseline hesaplamalarÄ±nda net Ã§alÄ±ÅŸma gÃ¼nÃ¼ kullanÄ±lÄ±r</p>
                    <p class="mb-0"><strong>ğŸ‘¥ Ekip Koordinasyonu:</strong> "X kiÅŸisi izinli, gÃ¶revi Y'ye atayalÄ±m" kararlarÄ± kolaylaÅŸÄ±r</p>
                </div>`
            }
        ]
    }
};

function showToolInfo(toolKey) {
    const tool = toolInfoData[toolKey];
    if (!tool) return;
    
    const modal = new bootstrap.Modal(document.getElementById('toolInfoModal'));
    document.getElementById('toolInfoTitle').innerHTML = `<i class="${tool.icon} me-2"></i>${tool.title}`;
    
    let sectionsHtml = '';
    tool.sections.forEach(section => {
        sectionsHtml += `
            <div class="mb-4">
                <h5 class="text-${tool.color} mb-3">
                    <i class="fas fa-chevron-right me-2"></i>${section.heading}
                </h5>
                ${section.content}
            </div>
        `;
    });
    
    document.getElementById('toolInfoBody').innerHTML = sectionsHtml;
    
    const actionBtn = document.getElementById('toolInfoActionBtn');
    actionBtn.onclick = function() {
        window.location.href = tool.url;
    };
    
    modal.show();
}

// Info butonlarÄ±nÄ±n link'i engellemesi iÃ§in
document.querySelectorAll('.tool-info-btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
    });
});
</script>
{% endblock %}
