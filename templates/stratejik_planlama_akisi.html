{% extends "base.html" %}

{% block title %}Stratejik Planlama Akışı - {{ kurum.kisa_ad }}{% endblock %}

{% block styles %}
<style>
    .flow-container {
        padding: 30px;
        max-width: 1400px;
        margin: 0 auto;
    }

    .flow-box {
        border: 3px solid;
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        background: white;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        position: relative;
        min-height: 100px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .flow-box:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
    }

    .flow-box.blue {
        border-color: #3498db;
        background: linear-gradient(135deg, #ffffff 0%, #e3f2fd 100%);
    }

    .flow-box.green {
        border-color: #27ae60;
        background: linear-gradient(135deg, #ffffff 0%, #e8f5e9 100%);
    }

    .flow-box.purple {
        border-color: #9b59b6;
        background: linear-gradient(135deg, #ffffff 0%, #f3e5f5 100%);
    }

    .flow-box.orange {
        border-color: #e67e22;
        background: linear-gradient(135deg, #ffffff 0%, #fff3e0 100%);
    }

    .flow-box h4 {
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 15px;
        font-size: 1.1rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        opacity: 0.7;
    }

    .flow-box p {
        color: #95a5a6;
        margin: 0;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        opacity: 0.6;
    }

    /* İçerik stilleri - DAHA BÜYÜK VE İNTERAKTİF */
    .flow-box .content-preview {
        margin-top: 15px;
        padding: 15px 20px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 12px;
        font-size: 1.3rem;
        font-weight: 600;
        color: #2c3e50;
        line-height: 1.6;
        transition: all 0.3s ease;
        cursor: pointer;
        border: 2px solid transparent;
        min-height: 80px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }

    .flow-box .content-preview:hover {
        background: rgba(255, 255, 255, 1);
        transform: scale(1.02);
        border-color: rgba(52, 152, 219, 0.3);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .flow-box .content-large {
        font-size: 1.5rem;
        font-weight: 700;
        color: #2c3e50;
        margin-top: 15px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 12px;
        line-height: 1.8;
        transition: all 0.3s ease;
        cursor: pointer;
        border: 2px solid transparent;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        min-height: 100px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }

    .flow-box .content-large:hover {
        background: rgba(255, 255, 255, 1);
        transform: scale(1.03);
        border-color: rgba(52, 152, 219, 0.4);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .flow-box .item-list {
        margin-top: 15px;
        padding: 15px 20px;
        text-align: left;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 10px;
    }

    .flow-box .item-list ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .flow-box .item-list li {
        margin: 10px 0;
        padding: 12px 15px;
        background: white;
        border-radius: 8px;
        font-size: 1.1rem;
        font-weight: 600;
        color: #2c3e50;
        transition: all 0.3s ease;
        cursor: pointer;
        border-left: 4px solid transparent;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    .flow-box .item-list li:hover {
        transform: translateX(5px);
        border-left-color: #3498db;
        box-shadow: 0 4px 10px rgba(52, 152, 219, 0.2);
        background: #f8f9fa;
    }

    .flow-box .item-list li.more-items {
        opacity: 0.6;
        font-size: 0.95rem;
        font-weight: 500;
        font-style: italic;
    }

    .flow-arrow {
        text-align: center;
        font-size: 2rem;
        color: #3498db;
        margin: 10px 0;
    }

    .flow-arrow-horizontal {
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: #3498db;
    }

    .badge-count {
        position: absolute;
        top: 10px;
        right: 10px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 20px;
        padding: 5px 12px;
        font-size: 0.85rem;
        font-weight: bold;
    }

    .info-icon {
        position: absolute;
        top: 10px;
        left: 10px;
        color: #3498db;
        font-size: 1.2rem;
    }

    .empty-state {
        color: #95a5a6;
        font-style: italic;
        font-size: 0.9rem;
    }

    /* Pulse animasyonu interaktif içerikler için */
    @keyframes contentPulse {

        0%,
        100% {
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        50% {
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.15);
        }
    }

    .flow-box .content-large:hover,
    .flow-box .content-preview:hover {
        animation: contentPulse 1.5s ease-in-out;
    }

    /* İçerik tıklanabilir göstergesi */
    .flow-box .content-large::before,
    .flow-box .content-preview::before {
        content: '';
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        opacity: 0;
        transition: opacity 0.3s ease;
        font-size: 1.2rem;
    }

    .flow-box .content-large:hover::before,
    .flow-box .content-preview:hover::before {
        opacity: 0.7;
    }

    .strategy-tree {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .strategy-header {
        text-align: center;
        margin-bottom: 20px;
        padding: 15px 30px;
        background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
        color: white;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(155, 89, 182, 0.3);
    }

    .strategy-row {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }

    .ana-strateji-box {
        min-width: 250px;
        max-width: 300px;
        padding: 20px;
        background: linear-gradient(135deg, #ffffff 0%, #f3e5f5 100%);
        border: 3px solid #9b59b6;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .ana-strateji-box:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(155, 89, 182, 0.3);
    }

    .ana-strateji-box h5 {
        color: #8e44ad;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .ana-strateji-box p {
        color: #666;
        font-size: 0.85rem;
        margin: 0;
    }

    .alt-strateji-container {
        margin-top: 10px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 10px;
    }

    .alt-strateji-item {
        background: white;
        border-left: 4px solid #e67e22;
        padding: 10px;
        margin: 5px 0;
        border-radius: 5px;
        font-size: 0.85rem;
    }

    .alt-strateji-item strong {
        color: #e67e22;
    }

    .process-tree {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .process-header {
        text-align: center;
        margin-bottom: 20px;
        padding: 15px 30px;
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
    }

    .process-row {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }

    .surec-box {
        min-width: 280px;
        max-width: 320px;
        padding: 20px;
        background: linear-gradient(135deg, #ffffff 0%, #e3f2fd 100%);
        border: 3px solid #3498db;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .surec-box:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(52, 152, 219, 0.3);
    }

    .surec-box h5 {
        color: #2980b9;
        font-weight: bold;
        margin-bottom: 10px;
        font-size: 1.1rem;
    }

    .surec-box .surec-info {
        color: #666;
        font-size: 0.8rem;
        margin-bottom: 10px;
    }

    .pg-container {
        margin-top: 10px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 10px;
    }

    .pg-item {
        background: white;
        border-left: 4px solid #27ae60;
        padding: 8px 10px;
        margin: 5px 0;
        border-radius: 5px;
        font-size: 0.8rem;
    }

    .pg-item .pg-name {
        color: #27ae60;
        font-weight: bold;
    }

    .pg-item .pg-details {
        color: #666;
        font-size: 0.75rem;
        margin-top: 3px;
    }

    .pg-item .pg-badge {
        display: inline-block;
        background: #27ae60;
        color: white;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.7rem;
        margin-right: 5px;
    }

    /* Kurum Logosu Stili */
    .kurum-logo-container {
        position: relative;
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .kurum-logo {
        width: 80px;
        height: 80px;
        object-fit: contain;
        border-radius: 12px;
        border: 3px solid #e0e0e0;
        background: white;
        padding: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

    .kurum-logo:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 18px rgba(52, 152, 219, 0.3);
        border-color: #3498db;
    }

    .kurum-logo-placeholder {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: white;
        font-weight: bold;
        border: 3px solid #2980b9;
        box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        transition: all 0.3s ease;
    }

    .kurum-logo-placeholder:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 18px rgba(52, 152, 219, 0.4);
    }

    .kurum-bilgi-mini {
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .kurum-bilgi-mini .kurum-unvan {
        font-size: 0.9rem;
        font-weight: 600;
        color: #2c3e50;
        margin: 0;
        line-height: 1.3;
    }

    .kurum-bilgi-mini .kurum-kisa-ad {
        font-size: 0.75rem;
        color: #95a5a6;
        margin: 0;
    }


    /* Ekosistem Stilleri */
    .ecosystem-container {
        padding: 30px;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 20px;
        margin: 20px 0;
    }

    .ecosystem-main-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }

    .ecosystem-map-container {
        position: relative;
        width: 100vw;
        height: 1000px;
        margin: 40px calc(-50vw + 50%);
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .ecosystem-map {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .ecosystem-global-ring {
        position: absolute;
        width: 2000px;
        height: 800px;
        border: 18px solid #2E8B57;
        /* Koyu yeşil */
        border-radius: 50%;
        background: linear-gradient(135deg, #2E8B57 0%, #3CB371 100%);
        color: #2c3e50;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        transition: all 0.3s ease;
        box-shadow: 0 25px 60px rgba(46, 139, 87, 0.4);
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 1;
        /* En dış halka */
        padding-top: 60px;
    }

    .global-title {
        font-size: 2.2rem;
        font-weight: 800;
        color: #ffffff;
        text-align: center;
        margin-bottom: 20px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        letter-spacing: 0.5px;
    }

    .global-items {
        position: relative;
        width: 100%;
        height: 100%;
    }

    .global-item {
        position: absolute;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 15px 20px;
        font-size: 1rem;
        font-weight: 600;
        color: #2c3e50;
        text-align: center;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: box-shadow 0.2s ease, background-color 0.2s ease;
        white-space: nowrap;
        border: 2px solid #2E8B57;
        cursor: move;
        user-select: none;
        width: 170px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .global-item:hover {
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        background: rgba(255, 255, 255, 1);
        border-color: #2c3e50;
        color: #2c3e50;
        font-weight: 700;
    }

    .global-item.dragging {
        z-index: 1000;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        border-color: #ff6b6b;
        background: rgba(255, 255, 255, 1);
    }

    .ecosystem-market-ring {
        position: absolute;
        width: 1600px;
        height: 640px;
        border: 15px solid #20B2AA;
        border-radius: 50%;
        background: linear-gradient(135deg, #20B2AA 0%, #48CAE4 100%);
        color: #2c3e50;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        transition: all 0.3s ease;
        box-shadow: 0 20px 50px rgba(32, 178, 170, 0.4);
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 2;
        padding-top: 50px;
    }

    .ecosystem-market-ring:hover {
        transform: translate(-50%, -50%) scale(1.02);
        box-shadow: 0 25px 60px rgba(32, 178, 170, 0.5);
    }

    .market-title {
        font-size: 2.2rem;
        font-weight: 700;
        color: #2c3e50;
        text-align: center;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        margin-top: 0;
    }

    .market-items {
        position: absolute;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        padding: 80px;
    }

    .market-item,
    .stakeholder-item {
        position: absolute;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 12px;
        padding: 12px 18px;
        font-size: 0.85rem;
        font-weight: 600;
        color: #2c3e50;
        text-align: center;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        transition: box-shadow 0.2s ease, background-color 0.2s ease;
        white-space: nowrap;
        border: 2px solid #20B2AA;
        cursor: move;
        user-select: none;
        width: 150px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .stakeholder-item {
        border: 2px solid #87CEEB;
        font-size: 0.9rem;
        padding: 10px 15px;
    }

    .market-item:hover,
    .stakeholder-item:hover {
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        background: rgba(255, 255, 255, 1);
        border-color: #2c3e50;
        color: #2c3e50;
        font-weight: 700;
    }

    .market-item.dragging,
    .stakeholder-item.dragging {
        z-index: 1000;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        border-color: #ff6b6b;
        background: rgba(255, 255, 255, 1);
    }

    .ecosystem-stakeholders-ring {
        position: absolute;
        width: 1000px;
        height: 400px;
        border: 12px solid #87CEEB;
        border-radius: 50%;
        background: linear-gradient(135deg, #87CEEB 0%, #B0E0E6 100%);
        color: #2c3e50;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        transition: all 0.3s ease;
        box-shadow: 0 15px 40px rgba(135, 206, 235, 0.4);
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 3;
        padding-top: 40px;
    }

    .ecosystem-stakeholders-ring:hover {
        transform: translate(-50%, -50%) scale(1.05);
        box-shadow: 0 15px 40px rgba(135, 206, 235, 0.4);
    }

    .stakeholders-title {
        font-size: 2rem;
        font-weight: 700;
        color: #2c3e50;
        text-align: center;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        margin-top: 0;
    }

    .stakeholders-items {
        position: absolute;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        padding: 60px;
    }

    .stakeholder-item {
        position: absolute;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 10px;
        padding: 10px 15px;
        font-size: 0.9rem;
        font-weight: 600;
        color: #2c3e50;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: all 0.2s ease;
        white-space: nowrap;
        border: 2px solid #87CEEB;
    }

    .stakeholder-item:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        background: rgba(255, 255, 255, 1);
        border-color: #2c3e50;
        color: #2c3e50;
        font-weight: 700;
    }

    /* Paydaş öİelerinin konumları - Halka içinde eşit daİılım */
    .stakeholders-items .stakeholder-item:nth-child(1) {
        top: 20%;
        left: 20%;
        transform: translate(-50%, -50%);
    }

    .stakeholders-items .stakeholder-item:nth-child(2) {
        top: 20%;
        right: 20%;
        transform: translate(50%, -50%);
    }

    .stakeholders-items .stakeholder-item:nth-child(3) {
        top: 50%;
        right: 10%;
        transform: translate(50%, -50%);
    }

    .stakeholders-items .stakeholder-item:nth-child(4) {
        bottom: 30%;
        right: 20%;
        transform: translate(50%, 50%);
    }

    .stakeholders-items .stakeholder-item:nth-child(5) {
        bottom: 25%;
        left: 50%;
        transform: translate(-50%, 50%);
    }

    .stakeholders-items .stakeholder-item:nth-child(6) {
        bottom: 30%;
        left: 20%;
        transform: translate(-50%, 50%);
    }

    /* Pazar halkasındaki öİelerin konumları - Halkanın içinde */
    .market-items .market-item:nth-child(1) {
        /* Aracılar */
        position: absolute;
        top: 20%;
        right: 15%;
        transform: translate(50%, -50%);
    }

    .market-items .market-item:nth-child(2) {
        /* Potansiyel Müşteriler */
        position: absolute;
        top: 20%;
        left: 15%;
        transform: translate(-50%, -50%);
    }

    .market-items .market-item:nth-child(3) {
        /* Özel İlgi Grupları */
        position: absolute;
        top: 50%;
        right: 10%;
        transform: translate(50%, -50%);
    }

    .market-items .market-item:nth-child(4) {
        /* Yeni Girişimler */
        position: absolute;
        top: 45%;
        left: 10%;
        transform: translate(-50%, -50%);
    }

    .market-items .market-item:nth-child(5) {
        /* Basın ve Sosyal Medya */
        position: absolute;
        top: 60%;
        left: 15%;
        transform: translate(-50%, -50%);
    }

    .market-items .market-item:nth-child(6) {
        /* Rakipler */
        position: absolute;
        bottom: 20%;
        left: 40%;
        transform: translate(-50%, 50%);
    }

    .market-items .market-item:nth-child(7) {
        /* Yenilikler */
        position: absolute;
        bottom: 20%;
        left: 60%;
        transform: translate(-50%, 50%);
    }

    .market-items .market-item:nth-child(8) {
        /* Mevzuat */
        position: absolute;
        bottom: 30%;
        left: 20%;
        transform: translate(-50%, 50%);
    }

    .market-items .market-item:nth-child(9) {
        /* İstihdam */
        position: absolute;
        bottom: 25%;
        right: 20%;
        transform: translate(50%, 50%);
    }

    /* Küresel Çevre Halkasındaki öİelerin konumları */
    .global-items .global-item:nth-child(1) {
        /* Küresel Isınma */
        position: absolute;
        top: 25%;
        left: 20%;
        transform: translate(-50%, -50%);
    }

    .global-items .global-item:nth-child(2) {
        /* Paylaşım Ekonomisi */
        position: absolute;
        top: 45%;
        left: 15%;
        transform: translate(-50%, -50%);
    }

    .global-items .global-item:nth-child(3) {
        /* Demografik Çeşitlilik */
        position: absolute;
        bottom: 35%;
        left: 20%;
        transform: translate(-50%, 50%);
    }

    .global-items .global-item:nth-child(4) {
        /* Yıkıcı Teknolojiler */
        position: absolute;
        bottom: 25%;
        left: 50%;
        transform: translate(-50%, 50%);
    }

    .global-items .global-item:nth-child(5) {
        /* Jeopolitik Belirsizlik */
        position: absolute;
        bottom: 35%;
        right: 20%;
        transform: translate(50%, 50%);
    }

    .global-items .global-item:nth-child(6) {
        /* BM Sürdürülebilir Kalkınma Amaçları */
        position: absolute;
        top: 45%;
        right: 15%;
        transform: translate(50%, -50%);
    }

    .global-items .global-item:nth-child(7) {
        /* Toplumsal Eİilimler */
        position: absolute;
        top: 25%;
        right: 20%;
        transform: translate(50%, -50%);
    }

    .global-items .global-item:nth-child(8) {
        /* Ham Maddeler */
        position: absolute;
        top: 20%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

    .ecosystem-center {
        width: 300px;
        height: 120px;
        border: 4px solid #228B22;
        border-radius: 50%;
        background: linear-gradient(135deg, #228B22 0%, #32CD32 100%);
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        transition: all 0.3s ease;
        box-shadow: 0 10px 30px rgba(34, 139, 34, 0.3);
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 4;
    }

    .ecosystem-center:hover {
        transform: translate(-50%, -50%) scale(1.05);
        box-shadow: 0 15px 40px rgba(34, 139, 34, 0.4);
    }

    .center-content {
        margin-top: 5px;
    }

    .organization-name {
        font-size: 0.9rem;
        font-weight: 600;
        color: white;
        text-align: center;
        background: rgba(255, 255, 255, 0.2);
        padding: 8px 12px;
        border-radius: 15px;
        margin-top: 5px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .center-title {
        font-size: 1.4rem;
        font-weight: 700;
        margin-bottom: 5px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        text-align: center;
    }

    .center-items {
        font-size: 0.9rem;
        text-align: center;
        max-width: 250px;
    }

    /* Baİlantı Kutuları */
    .ecosystem-connections {
        position: absolute;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }

    .connection-box {
        position: absolute;
        background: rgba(255, 255, 255, 0.95);
        border: 2px solid #dee2e6;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        pointer-events: all;
        transition: all 0.3s ease;
        width: 180px;
        height: 80px;
        text-align: center;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .connection-box:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .connection-title {
        font-size: 0.9rem;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 8px;
        text-align: center;
    }

    .connection-subtitle {
        font-size: 0.7rem;
        color: #6c757d;
        text-align: center;
        margin-bottom: 8px;
    }

    /* Baİlantı kutularının konumları - Eşit aralıklarla */
    .leadership {
        bottom: 20px;
        left: 8.33%;
        transform: translateX(-50%);
        border-color: #17a2b8;
        background: rgba(23, 162, 184, 0.1);
    }

    .strategy {
        bottom: 20px;
        left: 25%;
        transform: translateX(-50%);
        border-color: #e83e8c;
        background: rgba(232, 62, 140, 0.1);
    }

    .management {
        bottom: 20px;
        left: 41.67%;
        transform: translateX(-50%);
        border-color: #6f42c1;
        background: rgba(111, 66, 193, 0.1);
    }

    .culture {
        bottom: 20px;
        left: 58.33%;
        transform: translateX(-50%);
        border-color: #20c997;
        background: rgba(32, 201, 151, 0.1);
    }

    .performance {
        bottom: 20px;
        left: 75%;
        transform: translateX(-50%);
        border-color: #ffc107;
        background: rgba(255, 193, 7, 0.1);
    }

    .purpose {
        bottom: 20px;
        left: 91.67%;
        transform: translateX(-50%);
        border-color: #fd7e14;
        background: rgba(253, 126, 20, 0.1);
    }


    /* Düzenle Modal Styles */
    .edit-modal-backdrop {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 9998;
        backdrop-filter: blur(5px);
        animation: fadeIn 0.3s ease;
    }

    .edit-modal-backdrop.active {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .edit-modal {
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        width: 90%;
        max-width: 600px;
        overflow: hidden;
        animation: slideUp 0.3s ease;
        transform-origin: center;
        position: relative;
        z-index: 9999;
    }

    .edit-modal-header {
        padding: 20px 25px;
        color: white;
        font-weight: 600;
        font-size: 1.1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .edit-modal-header.success {
        background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
    }

    .edit-modal-header.info {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    }

    .edit-modal-header.warning {
        background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
    }

    .edit-modal-header.danger {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    }

    .edit-modal-close {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        font-size: 1.5rem;
        width: 35px;
        height: 35px;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
        line-height: 1;
    }

    .edit-modal-close:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: rotate(90deg);
    }

    .edit-modal-body {
        padding: 30px 25px;
    }

    .edit-modal-label {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 10px;
        font-size: 0.95rem;
        display: block;
    }

    .edit-modal-textarea {
        width: 100%;
        min-height: 120px;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 1rem;
        resize: vertical;
        transition: all 0.3s ease;
        font-family: inherit;
    }

    .edit-modal-textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    .edit-modal-footer {
        padding: 20px 25px;
        background: #f8f9fa;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }

    .edit-modal-btn {
        padding: 10px 25px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.95rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .edit-modal-btn-cancel {
        background: #e0e0e0;
        color: #666;
    }

    .edit-modal-btn-cancel:hover {
        background: #d0d0d0;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .edit-modal-btn-save {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .edit-modal-btn-save:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(102, 126, 234, 0.4);
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    @keyframes slideUp {
        from {
            transform: translateY(50px);
            opacity: 0;
        }

        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    /* ==========================================================================
       MODERN PREMIUM DASHBOARD STYLES (Glassmorphism & Neon)
       ========================================================================== */
    :root {
        --glass-bg: rgba(23, 25, 35, 0.7);
        --glass-border: rgba(255, 255, 255, 0.08);
        --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        --neon-blue: #00f3ff;
        --neon-purple: #bc13fe;
        --neon-green: #00ff9d;
        --neon-red: #ff0055;
        --neon-orange: #ff9100;
        --neon-yellow: #f9f871;
        --dark-bg: #0f172a;
        --card-bg-dark: rgba(30, 41, 59, 0.7);
        --text-primary: #f8fafc;
        --text-secondary: #94a3b8;
    }

    /* Modal Dark Theme Override */
    .modal-content.premium-dark {
        background-color: var(--dark-bg);
        background-image:
            radial-gradient(at 0% 0%, hsla(253, 16%, 7%, 1) 0, transparent 50%),
            radial-gradient(at 50% 0%, hsla(225, 39%, 30%, 1) 0, transparent 50%),
            radial-gradient(at 100% 0%, hsla(339, 49%, 30%, 1) 0, transparent 50%);
        color: var(--text-primary);
        border: 1px solid var(--glass-border);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }

    .premium-dark .modal-header {
        border-bottom: 1px solid var(--glass-border);
        background: rgba(0, 0, 0, 0.2);
    }

    .premium-dark .modal-footer {
        border-top: 1px solid var(--glass-border);
        background: rgba(0, 0, 0, 0.2);
    }

    .premium-dark .btn-close {
        filter: invert(1) grayscale(100%) brightness(200%);
    }

    /* Glass Cards */
    .glass-card {
        background: var(--card-bg-dark);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid var(--glass-border);
        border-radius: 16px;
        padding: 24px;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        height: 100%;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    .glass-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        opacity: 0;
        transition: opacity 0.3s;
    }

    .glass-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--glass-shadow);
        border-color: rgba(255, 255, 255, 0.2);
    }

    .glass-card:hover::before {
        opacity: 1;
    }

    /* Typography */
    .premium-title {
        font-family: 'Inter', system-ui, -apple-system, sans-serif;
        font-weight: 800;
        letter-spacing: -0.025em;
        background: linear-gradient(to right, #fff, #94a3b8);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 0.5rem;
    }

    .premium-subtitle {
        color: var(--text-secondary);
        font-size: 0.9rem;
        font-weight: 500;
        letter-spacing: 0.05em;
        text-transform: uppercase;
    }

    /* Neon Accents */
    .neon-border-green {
        box-shadow: 0 0 15px rgba(0, 255, 157, 0.1);
        border-top: 3px solid var(--neon-green);
    }

    .neon-border-red {
        box-shadow: 0 0 15px rgba(255, 0, 85, 0.1);
        border-top: 3px solid var(--neon-red);
    }

    .neon-border-blue {
        box-shadow: 0 0 15px rgba(0, 243, 255, 0.1);
        border-top: 3px solid var(--neon-blue);
    }

    .neon-border-orange {
        box-shadow: 0 0 15px rgba(255, 145, 0, 0.1);
        border-top: 3px solid var(--neon-orange);
    }

    .neon-border-purple {
        box-shadow: 0 0 15px rgba(188, 19, 254, 0.1);
        border-top: 3px solid var(--neon-purple);
    }

    .neon-text-green {
        color: var(--neon-green);
        text-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
    }

    .neon-text-red {
        color: var(--neon-red);
        text-shadow: 0 0 10px rgba(255, 0, 85, 0.5);
    }

    .neon-text-blue {
        color: var(--neon-blue);
        text-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
    }

    .neon-text-orange {
        color: var(--neon-orange);
        text-shadow: 0 0 10px rgba(255, 145, 0, 0.5);
    }

    /* Layouts */
    .premium-grid-2x2 {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 24px;
    }

    .premium-grid-hex {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
    }

    /* Action Buttons */
    .btn-premium {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--text-primary);
        backdrop-filter: blur(4px);
        transition: all 0.3s;
        border-radius: 8px;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 10px 20px;
    }

    .btn-premium:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateY(-2px);
        color: white;
        box-shadow: 0 10px 20px -10px rgba(0, 0, 0, 0.5);
    }

    .btn-premium-primary {
        background: linear-gradient(135deg, var(--neon-blue), var(--neon-purple));
        border: none;
        color: white;
    }

    .btn-premium-primary:hover {
        opacity: 0.9;
        box-shadow: 0 0 20px rgba(188, 19, 254, 0.4);
    }

    /* List Items */
    .premium-list-item {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 8px;
        padding: 12px 16px;
        margin-bottom: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border: 1px solid rgba(255, 255, 255, 0.05);
        transition: all 0.2s;
    }

    .premium-list-item:hover {
        background: rgba(255, 255, 255, 0.08);
        border-color: rgba(255, 255, 255, 0.2);
        transform: translateX(4px);
    }

</style>
{% endblock %}

{% block content %}
<div class="flow-container">
    <!-- Başlık -->
    <div class="text-center mb-5">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <!-- Sol: Kurum Logosu -->
            <div class="kurum-logo-container">
                {% if kurum.logo_url %}
                {% set logo_url = kurum.logo_url %}
                {% if not logo_url.startswith('http://') and not logo_url.startswith('https://') %}
                {% if logo_url.startswith('/static/') %}
                {% set logo_url = url_for('static', filename=logo_url[8:]) %}
                {% else %}
                {% set logo_url = url_for('static', filename=logo_url.lstrip('/static/').lstrip('/')) %}
                {% endif %}
                {% endif %}
                <img src="{{ logo_url }}" alt="{{ kurum.kisa_ad }} Logo" class="kurum-logo"
                    title="{{ kurum.ticari_unvan }}"
                    onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="kurum-logo-placeholder" style="display: none;" title="{{ kurum.ticari_unvan }}">
                    {{ kurum.kisa_ad[0] if kurum.kisa_ad else 'K' }}
                </div>
                {% else %}
                <div class="kurum-logo-placeholder" title="{{ kurum.ticari_unvan }}">
                    {{ kurum.kisa_ad[0] if kurum.kisa_ad else 'K' }}
                </div>
                {% endif %}
                <div class="kurum-bilgi-mini d-none d-md-block">
                    <p class="kurum-unvan">{{ kurum.kisa_ad }}</p>
                    <p class="kurum-kisa-ad">{{ kurum.ticari_unvan[:40] }}...</p>
                </div>
            </div>

            <!-- Orta: Başlık -->
            <h2 class="mb-0">
                <i class="fas fa-project-diagram me-2"></i>
                Stratejik Planlama Akışı
            </h2>

            <!-- Saİ: Yenile Butonu -->
            <div>
                <a class="btn btn-sm btn-primary me-2" href="{{ url_for('main.stratejik_planlama_akisi_dinamik') }}"
                    title="Dinamik (canlı) stratejik planlama akışı">
                    <i class="fas fa-bolt me-1"></i> Dinamik Stratejik Planlama
                </a>
                <button class="btn btn-sm btn-outline-primary" onclick="refreshPageData()" id="refreshBtn"
                    title="Sayfayı yenile">
                    <i class="fas fa-sync-alt" id="refreshIcon"></i> Yenile
                </button>
            </div>
        </div>
        <small class="text-muted" id="lastGüncelleSaat">
            <i class="fas fa-clock me-1"></i>Son güncelleme: Şimdi
        </small>
        <div class="mt-2">
            <div class="form-check form-switch d-inline-block">
                <input class="form-check-input" type="checkbox" id="autoRefreshToggle">
                <label class="form-check-label small text-muted" for="autoRefreshToggle">
                    Otomatik yenileme (30 saniyede bir)
                </label>
            </div>
        </div>
    </div>

    <script>
        // Inline onclick handler'lar için güvenli global fallback
        if (!window.openModal) {
            window.openModal = function (section) {
                const modalEl = document.getElementById('detailModal');
                if (!modalEl) {
                    console.warn('detailModal bulunamadı');
                    return;
                }
                const modalTitle = document.getElementById('modalBaşlık');
                const modalBody = document.getElementById('modalBody');
                if (modalTitle) {
                    const titles = {
                        'degerler': 'Değerler ve Etik Kurallar',
                        'amac': 'Amaç (Purpose)',
                        'kalite': 'Kalite Politikası',
                        'ekosistem': 'Ekosistem',
                        'vizyon': 'Vizyon',
                        'anaStratejiler': 'Ana Stratejiler',
                        'altStratejiler': 'Alt Stratejiler'
                    modalTitle.textContent = titles[section] || 'Detaylar';
                }
                if (modalBody && typeof window.loadModalContent === 'function') {
                    window.loadModalContent(section, modalBody);
                }
                if (window.bootstrap && window.bootstrap.Modal) {
                    window.bootstrap.Modal.getOrCreateInstance(modalEl).show();
                } else {
                    modalEl.classList.add('show');
                    modalEl.style.display = 'block';
                }
        }
    </script>

    <!-- Üst Satır: Değerler, Amaç, Kalite Politikası -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="flow-box blue" onclick="openModal('degerler')">
                <i class="info-icon fas fa-heart"></i>
                {% if degerler|length > 0 %}
                <span class="badge-count">{{ degerler|length }}</span>
                {% endif %}
                <h4>Değerler ve Etik Kurallar</h4>
                <p>Values and Ethics</p>
                {% if degerler|length > 0 or etik_kurallari|length > 0 %}
                <div class="item-list">
                    <ul>
                        {% for deger in degerler[:3] %}
                        <li title="{{ deger.aciklama }}">{{ deger.baslik }}</li>
                        {% endfor %}
                        {% if degerler|length > 3 %}
                        <li class="more-items">+{{ degerler|length - 3 }} daha...</li>
                        {% endif %}
                    </ul>
                </div>
                {% else %}
                <div class="content-large" style="font-size: 1.1rem; opacity: 0.5;" title="Henüz eklenmedi">Henüz
                    eklenmedi</div>
                {% endif %}
            </div>
        </div>

        <div class="col-md-6">
            <div class="flow-box purple" onclick="openModal('amac')">
                <i class="info-icon fas fa-bullseye"></i>
                <h4>AMAÇ</h4>
                <p>Purpose</p>
                {% if amac %}
                <div class="content-large" title="{{ amac }}">{{ amac[:150] }}{% if amac|length > 150 %}...{% endif %}
                </div>
                {% else %}
                <div class="content-large" style="font-size: 1.1rem; opacity: 0.5;" title="Henüz tanımlanmadı">Henüz
                    tanımlanmadı</div>
                {% endif %}
            </div>
        </div>

        <div class="col-md-3">
            <div class="flow-box blue" onclick="openModal('kalite')">
                <i class="info-icon fas fa-certificate"></i>
                {% if kalite_politikalari|length > 0 %}
                <span class="badge-count">{{ kalite_politikalari|length }}</span>
                {% endif %}
                <h4>Kalite Politikası</h4>
                <p>Quality Policy</p>
                {% if kalite_politikalari|length > 0 %}
                <div class="item-list">
                    <ul>
                        {% for politika in kalite_politikalari[:2] %}
                        <li title="{{ politika.aciklama }}">{{ politika.baslik }}</li>
                        {% endfor %}
                        {% if kalite_politikalari|length > 2 %}
                        <li class="more-items">+{{ kalite_politikalari|length - 2 }} daha...</li>
                        {% endif %}
                    </ul>
                </div>
                {% else %}
                <div class="content-large" style="font-size: 1.1rem; opacity: 0.5;" title="Henüz eklenmedi">Henüz
                    eklenmedi</div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Ok -->
    <div class="flow-arrow">
        <i class="fas fa-arrow-down"></i>
    </div>

    <!-- Ekosistem -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="flow-box green" onclick="openModal('ekosistem')">
                <i class="info-icon fas fa-leaf"></i>
                <h4>EKOSİSTEM</h4>
                <p>Ecosystem</p>
                <div class="content-large" style="font-size: 1.2rem; opacity: 0.6; font-style: italic;"
                    title="Hazırlık Aşamasında">
                    Hazırlık Aşamasında
                </div>
            </div>
        </div>
    </div>

    <!-- Ok -->
    <div class="flow-arrow">
        <i class="fas fa-arrow-down"></i>
    </div>

    <!-- Vizyon -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="flow-box blue" onclick="openModal('vizyon')">
                <i class="info-icon fas fa-eye"></i>
                <h4>VİZYON</h4>
                <p>Vision</p>
                {% if vizyon %}
                <div class="content-large" title="{{ vizyon }}">{{ vizyon[:200] }}{% if vizyon|length > 200 %}...{%
                    endif %}</div>
                {% else %}
                <div class="content-large" style="font-size: 1.1rem; opacity: 0.5;" title="Henüz tanımlanmadı">Henüz
                    tanımlanmadı</div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Ok -->
    <div class="flow-arrow">
        <i class="fas fa-arrow-down"></i>
    </div>

    <!-- Durum Analizi & Strateji Üretimi -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4 class="mb-0">Durum Analizi &amp; Strateji Üretimi</h4>
                        <small class="text-muted">Stratejik analiz merkezi</small>
                    </div>
                    <div class="row g-3">
                        <div class="col-12 col-lg-4">
                            <a class="text-decoration-none" href="{{ url_for('analysis.analysis_hub', kurum_id=kurum.id) }}">
                                <div class="card h-100 border-0 shadow-sm">
                                    <div class="card-body d-flex justify-content-between align-items-center">
                                        <div>
                                            <div class="fw-semibold">SWOT</div>
                                            <div class="text-muted small">
                                                {% if swot_count > 0 %}{{ swot_count }} Tespit{% else %}Başlanmadı{% endif %}
                                            </div>
                                        </div>
                                        <i class="fas fa-chess-board fa-2x text-success"></i>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div class="col-12 col-lg-4">
                            <a class="text-decoration-none" href="{{ url_for('analysis.analysis_hub', kurum_id=kurum.id) }}">
                                <div class="card h-100 border-0 shadow-sm">
                                    <div class="card-body d-flex justify-content-between align-items-center">
                                        <div>
                                            <div class="fw-semibold">PESTLE</div>
                                            <div class="text-muted small">
                                                {% if pestle_count > 0 %}{{ pestle_count }} Tespit{% else %}Başlanmadı{% endif %}
                                            </div>
                                        </div>
                                        <i class="fas fa-globe fa-2x text-primary"></i>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div class="col-12 col-lg-4">
                            <a class="text-decoration-none" href="{{ url_for('analysis.tows_matrix', kurum_id=kurum.id) }}">
                                <div class="card h-100 border-0 shadow-sm">
                                    <div class="card-body d-flex justify-content-between align-items-center">
                                        <div>
                                            <div class="fw-semibold">TOWS Matrisi</div>
                                            <div class="text-muted small">
                                                {% if tows_strategy_count > 0 %}{{ tows_strategy_count }} Strateji{% else %}Başlanmadı{% endif %}
                                            </div>
                                        </div>
                                        <i class="fas fa-project-diagram fa-2x text-warning"></i>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- BSC Strateji Haritası -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3">
                    <div>
                        <h4 class="mb-1">
                            <i class="fas fa-sitemap text-primary me-2"></i>
                            BSC Strateji Haritası
                        </h4>
                        <div class="text-muted small">
                            Neden-sonuç ilişkilerini katmanlı harita üzerinde yönetin
                        </div>
                    </div>
                    <div>
                        <a class="btn btn-primary" href="{{ url_for('bsc.bsc_map', kurum_id=kurum.id) }}">
                            Haritaya Git
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ana Stratejiler ve Alt Stratejiler - Aİaç Yapısı -->
    <div class="strategy-tree mb-4">
        <div class="strategy-header">
            <h3 class="mb-0">
                <i class="fas fa-sitemap me-2"></i>
                Ana Stratejilerimiz
            </h3>
            <p class="mb-0 mt-2">Main Strategies</p>
        </div>

        <div class="flow-arrow">
            <i class="fas fa-arrow-down"></i>
        </div>

        {% if ana_stratejiler|length > 0 %}
        <div class="strategy-row">
            {% for ana_str in ana_stratejiler %}
            <div class="ana-strateji-box" onclick="openModal('anaStratejiler')">
                <h5>
                    <i class="fas fa-chess-queen me-2"></i>
                    {{ ana_str.ad }}
                    {% if main_scores_norm and (ana_str.id in main_scores_norm) %}
                    <span class="badge bg-dark ms-2" title="Normalize skor">{{ main_scores_norm[ana_str.id] }}%</span>
                    {% endif %}
                </h5>
                {% if ana_str.aciklama %}
                <p class="mb-2">{{ ana_str.aciklama[:60] }}{% if ana_str.aciklama|length > 60 %}...{% endif %}</p>
                {% endif %}

                {% if ana_str.alt_stratejiler|length > 0 %}
                <div class="alt-strateji-container">
                    <small class="text-muted d-block mb-2">
                        <i class="fas fa-arrow-down me-1"></i>
                        Alt Stratejiler ({{ ana_str.alt_stratejiler|length }})
                    </small>
                    {% for alt_str in ana_str.alt_stratejiler %}
                    <div class="alt-strateji-item">
                        <strong>{{ loop.index }}.</strong> {{ alt_str.ad }}
                        {% if sub_scores_norm and (alt_str.id in sub_scores_norm) %}
                        <span class="badge bg-secondary ms-2" title="Normalize skor">{{ sub_scores_norm[alt_str.id]
                            }}%</span>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <small class="text-muted d-block mt-2">
                    <i class="fas fa-info-circle me-1"></i>
                    Alt strateji eklenmedi
                </small>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center text-muted py-4">
            <i class="fas fa-sitemap fa-3x mb-3" style="opacity: 0.3;"></i>
            <p>Henüz ana strateji eklenmedi</p>
        </div>
        {% endif %}
    </div>

    <!-- Ok -->
    <div class="flow-arrow">
        <i class="fas fa-arrow-down"></i>
    </div>

    <!-- Süreç Hedefleri ve Performans Göstergeleri - Aİaç Yapısı -->
    <div class="process-tree mb-4">
        <div class="process-header">
            <h3 class="mb-0">
                <i class="fas fa-cogs me-2"></i>
                Süreç Hedefleri
            </h3>
            <p class="mb-0 mt-2">Process Targets</p>
        </div>

        <div class="flow-arrow">
            <i class="fas fa-arrow-down"></i>
        </div>

        {% if surecler|length > 0 %}
        <div class="process-row">
            {% for surec in surecler %}
            <div class="surec-box" onclick="window.location.href='{{ url_for('main.surec_paneli') }}'">
                <h5>
                    <i class="fas fa-project-diagram me-2"></i>
                    {{ surec.ad }}
                </h5>

                <div class="surec-info">
                    <span class="badge bg-primary">{{ surec.durum or 'Aktif' }}</span>
                    {% if process_scores_norm and (surec.id in process_scores_norm) %}
                    <span class="badge bg-dark" title="Süreç stratejik skor (normalize)">{{
                        process_scores_norm[surec.id] }}%</span>
                    {% endif %}
                    {% if surec.ilerleme %}
                    <span class="badge bg-success">{{ surec.ilerleme }}% İlerleme</span>
                    {% endif %}
                </div>

                {% if surec.performans_gostergeleri|length > 0 %}
                <div class="pg-container">
                    <small class="text-muted d-block mb-2">
                        <i class="fas fa-chart-line me-1"></i>
                        Performans Göstergeleri ({{ surec.performans_gostergeleri|length }})
                    </small>
                    {% for pg in surec.performans_gostergeleri[:3] %}
                    <div class="pg-item">
                        <div class="pg-name">{{ pg.ad }}</div>
                        <div class="pg-details">
                            {% if kpi_scores_norm and (pg.id in kpi_scores_norm) %}
                            <span class="pg-badge" title="PG ağırlıklı başarı puanı (normalize)">Skor: {{
                                kpi_scores_norm[pg.id] }}%</span>
                            {% endif %}
                            {% if pg.hedef_deger %}
                            <span class="pg-badge">Hedef: {{ pg.hedef_deger }} {{ pg.olcum_birimi or '' }}</span>
                            {% endif %}
                            {% if pg.periyot %}
                            <span class="text-muted">{{ pg.periyot }}</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                    {% if surec.performans_gostergeleri|length > 3 %}
                    <small class="text-muted d-block mt-2 text-center">
                        +{{ surec.performans_gostergeleri|length - 3 }} performans göstergesi daha...
                    </small>
                    {% endif %}
                </div>
                {% else %}
                <small class="text-muted d-block mt-2">
                    <i class="fas fa-info-circle me-1"></i>
                    Performans göstergesi eklenmedi
                </small>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center text-muted py-4">
            <i class="fas fa-cogs fa-3x mb-3" style="opacity: 0.3;"></i>
            <p>Henüz süreç eklenmedi</p>
        </div>
        {% endif %}
    </div>

    <!-- Ok -->
    <div class="flow-arrow">
        <i class="fas fa-arrow-down"></i>
    </div>

    <!-- Süreç İyileştirme Faaliyetleri -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="flow-box green" onclick="window.location.href='{{ url_for('main.surec_paneli') }}'">
                <i class="info-icon fas fa-tasks"></i>
                <h4>Süreç İyileştirme Faaliyetleri</h4>
                <p>Process Improvement Activities</p>
                <div class="content-large" style="color: #27ae60;">
                    <i class="fas fa-arrow-right me-2"></i>
                    Detaylı görüntüle ve yönet
                </div>
            </div>
        </div>
    </div>

    <!-- Ok -->
    <div class="flow-arrow">
        <i class="fas fa-arrow-down"></i>
    </div>

    <!-- Bireysel Hedefler -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="flow-box purple" onclick="window.location.href='{{ url_for('main.performans_kartim') }}'">
                <i class="info-icon fas fa-user-check"></i>
                <h4>Bireysel Hedefler</h4>
                <p>Individual Targets</p>
                <div class="content-large" style="color: #9b59b6;">
                    <i class="fas fa-arrow-right me-2"></i>
                    Bireysel panele git
                </div>
            </div>
        </div>
    </div>

    <!-- Geri Dönüş Okları -->
    <div class="text-center mt-4 mb-5">
        <p class="text-muted">
            <i class="fas fa-sync-alt me-2"></i>
            Sürekli iyileştirme döngüsü - Tüm seviyelerden geri bildirim
        </p>
    </div>
</div>

<!-- Genel Modal -->
<div class="modal fade" id="detailModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="modalBaşlık"></h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- İçerik dinamik yüklenecek -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
            </div>
        </div>
    </div>
</div>
<script>
    // ==================================
    // GLOBAL SCOPE - FONKSİYONLAR (Inline onclick için)
    // ==========================================

    let currentSection = null;
    let editingContent = null;

    // openModal fonksiyonunu GLOBAL SCOPE'ta tanımla
    window.openModal = function (section) {
        currentSection = section;
        const modal = new bootstrap.Modal(document.getElementById('detailModal'));

        const modalBaşlık = document.getElementById('modalBaşlık');
        const modalBody = document.getElementById('modalBody');
        const editButton = document.getElementById('editButton');

        // Başlıkları ayarla
        const titles = {
            'degerler': '<i class="fas fa-heart me-2"></i>Değerler ve Etik Kurallar',
            'amac': '<i class="fas fa-bullseye me-2"></i>Amaç (Purpose)',
            'kalite': '<i class="fas fa-certificate me-2"></i>Kalite Politikası',
            'ekosistem': '<i class="fas fa-leaf me-2"></i>Ekosistem',
            'vizyon': '<i class="fas fa-eye me-2"></i>Vizyon',
            'anaStratejiler': '<i class="fas fa-sitemap me-2"></i>Ana Stratejiler',
            'altStratejiler': '<i class="fas fa-stream me-2"></i>Alt Stratejiler'
        };

        modalBaşlık.innerHTML = titles[section] || 'Detaylar';

        if (typeof loadModalContent === 'function') {
            loadModalContent(section, modalBody);
        }

        // Düzenle butonunu göster/gizle
        // Düzenle butonunu göster/gizle
        const canEdit = {{ 'true' if current_user.sistem_rol in ['admin', 'kurum_yoneticisi', 'ust_yonetim'] else 'false' }};
    if (editButton) {
        eitButton.style
    .display = canEdit && ['degerler', 'amac', 'kalite', 'vizyon'].includes(section) ? 'inline-block' : 'none';
    }

    modal.show();
    }

    // Global scope'a expose et// loadModalContent fonksiyonunu da global scope'ta tanımla
    function loadModalContent(section, container) {
        container.innerHTML = '<div class="text-center py-4"><i class="fas fa-spinner fa-spin fa-2x"></i><p class="mt-2">Yükleniyor...</p></div>';

        switch (section) {
            case 'degerler':
                container.innerHTML = `
                <h6 class="mb-3">Değerler:</h6>
                <ul class="list-group mb-4">
                    {% for deger in degerler %}
                    <li class="list-group-item">
                        <strong>{{ deger.baslik }}</strong>
                        <p class="mb-0 text-muted small">{{ deger.aciklama }}</p>
                    </li>
                    {% else %}
                    <li class="list-group-item text-center text-muted">Henüz değer eklenmedi</li>
                    {% endfor %}
                </ul>
                `;
                break;

            case 'amac':
                container.innerHTML = `<p class="lead">{{ kurum.amac or 'Henüz amaç tanımlanmadı' }}</p>`;
                break;

            case 'kalite':
                container.innerHTML = `<p class="lead">{{ kurum.kalite_politikasi or 'Henüz kalite politikası tanımlanmadı' }}</p>`;
                break;

            case 'vizyon':
                container.innerHTML = `<p class="lead">{{ kurum.vizyon or 'Henüz vizyon tanımlanmadı' }}</p>`;
                break;

            case 'ekosistem':
                // Ekosistem için özel yükleme (DOMContentLoaded sonrası yapılacak)
                container.innerHTML = '<p class="text-center text-muted">Ekosistem yükleniyor...</p>';
                break;

            case 'anaStratejiler':
                container.innerHTML = `
                <ul class="list-group">
                    {% for ana in ana_stratejiler %}
                    <li class="list-group-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">{{ ana.ad }}</h6>
                                <p class="mb-1 text-muted">{{ ana.aciklama }}</p>
                                <small class="text-muted">Hedef Yıl: {{ ana.hedef_yil }}</small>
                            </div>
                        </div>
                    </li>
                    {% else %}
                    <li class="list-group-item text-center text-muted">Henüz ana strateji eklenmedi</li>
                    {% endfor %}
                </ul>
            `;
                break;

            case 'altStratejiler':
                container.innerHTML = `
                <ul class="list-group">
                    {% for alt in alt_stratejiler %}
                    <li class="list-group-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">{{ alt.ad }}</h6>
                                <p class="mb-1 text-muted">{{ alt.aciklama }}</p>
                                <small class="text-muted">
                                    <i class="fas fa-sitemap me-1"></i>
                                    Ana Strateji: {{ alt.ana_strateji.ad }}
                                </small>
                            </div>
                        </div>
                    </li>
                    {% else %}
                    <li class="list-group-item text-center text-muted">Henüz alt strateji eklenmedi</li>
                    {% endfor %}
                </ul>
            `;
                break;

            default:
                container.innerHTML = '<p class="text-center text-muted py-4">Bu bölüm henüz hazırlanmadı</p>';
        }
    }

    // Global scope'a expose et
    window.loadModalContent = loadModalContent;

    // Modal HTML'i dinamik olarak ekle
    document.addEventListener('DOMContentLoaded', function () {
        const editModalHTML = `
        <div class="edit-modal-backdrop" id="editModalBackdrop">
            <div class="edit-modal">
                <div class="edit-modal-header" id="editModalHeader">
                    <div>
                        <i class="fas fa-edit me-2"></i>
                        <span id="editModalBaşlık">Düzenle</span>
                    </div>
                    <button class="edit-modal-close" id="editModalCloseBtn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="edit-modal-body">
                    <label class="edit-modal-label" id="editModalLabel">İçerik:</label>
                    <textarea class="edit-modal-textarea" id="editModalTextarea" placeholder="İçeriği buraya girin..."></textarea>
                </div>
                <div class="edit-modal-footer">
                    <button class="edit-modal-btn edit-modal-btn-cancel" id="editModalİptalBtn">
                        <i class="fas fa-times me-2"></i>İptal
                    </button>
                    <button class="edit-modal-btn edit-modal-btn-save" id="editModalKaydetBtn">
                        <i class="fas fa-check me-2"></i>Kaydet
                    </button>
                </div>
            </div>
        </div>
        
        <div class="edit-modal-backdrop" id="deleteModalBackdrop">
            <div class="edit-modal" style="max-width: 450px;">
                <div class="edit-modal-header danger" id="deleteModalHeader">
                    <div>
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <span id="deleteModalBaşlık">Silme Onayı</span>
                    </div>
                    <button class="edit-modal-close" id="deleteModalCloseBtn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="edit-modal-body">
                    <p id="deleteModalMessage" style="font-size: 1rem; color: #2c3e50; margin: 0;"></p>
                </div>
                <div class="edit-modal-footer">
                    <button class="edit-modal-btn edit-modal-btn-cancel" id="deleteModalİptalBtn">
                        <i class="fas fa-times me-2"></i>İptal
                    </button>
                    <button class="edit-modal-btn" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white;" id="deleteModalConfirmBtn">
                        <i class="fas fa-trash me-2"></i>Sil
                    </button>
                </div>
            </div>
        </div>
    `;

        document.body.insertAdjacentHTML('beforeend', editModalHTML);

        // Event listeners ekle
        document.getElementById('editModalCloseBtn').addEventListener('click', hideDüzenleModal);
        document.getElementById('editModalİptalBtn').addEventListener('click', hideDüzenleModal);
        document.getElementById('editModalKaydetBtn').addEventListener('click', saveDüzenleModal);
        document.getElementById('deleteModalCloseBtn').addEventListener('click', hideSilConfirm);
        document.getElementById('deleteModalİptalBtn').addEventListener('click', hideSilConfirm);
        document.getElementById('deleteModalConfirmBtn').addEventListener('click', confirmSil);

        // ESC tuşu ile kapatma
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                const editBackdrop = document.getElementById('editModalBackdrop');
                const deleteBackdrop = document.getElementById('deleteModalBackdrop');
                if (editBackdrop && editBackdrop.classList.contains('active')) {
                    hideDüzenleModal();
                }
                if (deleteBackdrop && deleteBackdrop.classList.contains('active')) {
                    hideSilConfirm();
                }
            }
        });

        // Backdrop'a tıklayınca kapatma
        document.getElementById('editModalBackdrop').addEventListener('click', function (e) {
            if (e.target === this) {
                hideDüzenleModal();
            }
        });
        document.getElementById('deleteModalBackdrop').addEventListener('click', function (e) {
            if (e.target === this) {
                hideSilConfirm();
            }
        });
    });



    let editModalData = {
        type: '',
        category: '',
        itemId: null,
        currentText: ''

    /**
     * Düzenle modal'ı göster
     */
    functi    howD     eModal(type, category, it      currentText) {
        console.log('showDüzenleModal çağrıldı:', type, category, itemId, currentText);
        editModalData = { type, category, itemId, currentText };

        const backdrop = document.getElementById('editModalBackdrop');
        const header = document.getElementById('editModalHeader');
        const title = document.getElementById('editModalBaşlık');
        const label = document.getElementById('editModalLabel');
        const textarea = document.getElementById('editModalTextarea');

        console.log('Modal elementleri:', { backdrop, header, title, label, textarea });

        // Kategori adı artık analiz tipine göre doldurulmuyor
        let categoryAd = '';
        let headerClass = 'info';

        console.log('Modal kategori:', categoryAd, 'header class:', headerClass);

        // Modal içeriğini ayarla
        title.innerHTML = `<i class="fas fa-edit me-2"></i>${categoryAd} Düzenle`;
        label.textContent = `${categoryAd}:`;
        textarea.value = currentText;

        // Header rengini ayarla
        header.className = 'edit-modal-header ' + headerClass;

        console.log('Modal açılıyor...');

        // Modal'ı göster
        backdrop.classList.add('active');

        console.log('Modal backdrop active class eklendi');

        // Textarea'ya odaklan
        setTimeout(() => {
            textarea.focus();
            textarea.select();
            console.log('Textarea focus ve select yapıldı');
        }, 100);
    }

    /**
     * Düzenle modal'ı gizle
     */
    function hideDüzenleModal() {
           st b     op = document.getElement     'editModalBackdrop');
        const textarea = document.getElementById('editModalTextarea');

        backdrop.classList.remove('active');
        textarea.value = '';
        editModalData = { type: '', category: '', itemId: null, currentText: '' };
    }

    /**
     * Ekle modal'ı göster (yeni öğe eklemek için)
     */
    function showEk    dal(      category) {
        editModalData = { type, c     ry, itemId: null, currentText: '', isNew: true };

        const backdrop = document.getElementById('editModalBackdrop');
        const header = document.getElementById('editModalHeader');
        const title = document.getElementById('editModalBaşlık');
        const label = document.getElementById('editModalLabel');
        const textarea = document.getElementById('editModalTextarea');

        // Analiz tipleri kaldırıldı
        let categoryAd = '';
        let headerClass = 'success';

        // Modal içeriğini ayarla
        title.innerHTML = `<i class="fas fa-plus-circle me-2"></i>Yeni ${categoryAd} Ekle`;
        label.textContent = `${categoryAd}:`;
        textarea.value = '';
        textarea.placeholder = `Yeni ${categoryAd.toLowerCase()} girin...`;

        // Header rengini ayarla
        header.className = 'edit-modal-header ' + headerClass;

        // Modal'ı göster
        backdrop.classList.add('active');

        // Textarea'ya odaklan
        setTimeout(() => {
            textarea.focus();
        }, 100);
    }

    /**
     * Düzenle modal kaydet
     */
    function saveDüzenleModal() {
        console.log('===== saveDüzenle    l BA      =====');
        conso     g('editModalData:', editModalData);

        const textarea = document.getElementById('editModalTextarea');
        console.log('Textarea element:', textarea);
        console.log('Textarea value:', textarea ? textarea.value : 'TEXTAREA YOK!');

        if (!textarea) {
            console.error('TEXTAREA ELEMANI BULUNAMADI!');
            showToast('error', 'Form hatası');
            return;
        }

        const newText = textarea.value.trim();

        console.log('Yeni text:', newText);
        console.log('Text length:', newText.length);

        if (!newText) {
            showToast('warning', 'İçerik boş olamaz');
            return;
        }

        if (newText === editModalData.currentText && !editModalData.isNew) {
            console.log('Text değişmemiş, modal kapatılıyor');
            hideDüzenleModal();
            return;
        }

        const { type, category, itemId, isNew } = editModalData;

        console.log('Kayıt işlemi:', { type, category, itemId, isNew });

        if (type) {
            showToast('warning', 'Analiz tipi desteklenmiyor.');
        }
    }

    hideDüzenleModal();
}

    // ESC tuşu ile modal'ı kapat
    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
            const backdrop = document.getElementById('editModalBackdrop');
            if (backdrop && backdrop.classList.contains('active')) {
                hideDüzenleModal();
            }
        }
    });

    // Backdrop tıklaması ile modal'ı kapat
    document.addEventListener('click', function (e) {
        const editBackdrop = document.getElementById('editModalBackdrop');
        if (e.target === editBackdrop) {
            hideDüzenleModal();
        }

        const deleteBackdrop = document.getElementById('deleteModalBackdrop');
        if (e.target === deleteBackdrop) {
            hideSilConfirm();
        }
    });

    // Sil confirmation için global değişkenler
    let deleteConfirmData = {
        type: '',
        category: '',
        itemId: null

    /**
     * Silme onay modal'ını göster
     */
    function showSilConfirm(type, category, itemId) {
        deleteConf    ata      ype, category, itemId };

         onst backdrop = document.getElementById('deleteModalBackdrop');
        const message = document.getElementById('deleteModalMessage');

        message.innerHTML = 'Öğeyi silmek istediğinizden emin misiniz?<br><small class="text-muted">Bu işlem geri alınamaz.</small>';
        backdrop.classList.add('active');
    }

    /**
     * Silme onay modal'ını gizle
     */
    function hideSilConfirm() {
        const backdrop = document.getElem    yId(     teModalBackdrop');
        ba     p.classList.remove('active');
        deleteConfirmData = { type: '', category: '', itemId: null };
    }

    /**
     * Silme işlemini onayla ve gerçekleştir
     */
    function confirmSil() {
        const { type, category, it     } =     teConfirmData;

        const item = document.querySelector(`[data-category="${category}"][data-id="${itemId}"]`);
        if (item) {
            item.style.transition = 'all 0.3s ease';
            item.style.opacity = '0';
            item.style.transform = 'translateX(-100px)';

            setTimeout(() => {
                item.remove();
                showToast('warning', 'Öğe silindi');
            }, 300);
        }

        hideSilConfirm();
    }

    // NOT: openModal ve loadModalContent fonksiyonları artık global scope'ta tanımlı
    // (satır 2681 ve 2720 civarı) Bu yüzden burada tekrar tanımlamaya gerek yok

    // UYARI: Aşağıdaki loadModalContent fonksiyonu artık kullanılmıyor (global scope'ta var)
    // Ama kodu silmiyoruz çünkü bazı case'ler farklı olabilir

    function _OLD_loadModalContent_DO_NOT_USE(section, container) {
        container.innerHTML = '<div class="text-center py-4"><i class="fas fa-spinner fa-spin fa-2x"></i><p class="mt-2">Yükleniyor...</p></div>';

        switch (section) {
            case 'degerler':
                container.innerHTML = `
                <h6 class="mb-3">Değerler:</h6>
                <ul class="list-group mb-4">
                    {% for deger in degerler %}
                    <li class="list-group-item">
                        <strong>{{ deger.baslik }}</strong>
                        <p class="mb-0 text-muted">{{ deger.aciklama }}</p>
                    </li>
                    {% else %}
                    <li class="list-group-item text-center text-muted">Henüz deİer eklenmedi</li>
                    {% endfor %}
                </ul>
                
                <h6 class="mb-3">Etik Kuralları:</h6>
                <ul class="list-group">
                    {% for etik in etik_kurallari %}
                    <li class="list-group-item">
                        <strong>{{ etik.baslik }}</strong>
                        <p class="mb-0 text-muted">{{ etik.aciklama }}</p>
                    </li>
                    {% else %}
                    <li class="list-group-item text-center text-muted">Henüz etik kural eklenmedi</li>
                    {% endfor %}
                </ul>
            `;
                break;

            case 'amac':
                container.innerHTML = `
                <div class="card">
                    <div class="card-body">
                        {% if amac %}
                        <p class="lead">{{ amac }}</p>
                        {% else %}
                        <p class="text-muted text-center py-4">Henüz amaç tanımlanmadı</p>
                        {% endif %}
                    </div>
                </div>
            `;
                break;

            case 'kalite':
                container.innerHTML = `
                <ul class="list-group">
                    {% for politika in kalite_politikalari %}
                    <li class="list-group-item">
                        <strong>{{ politika.baslik }}</strong>
                        <p class="mb-0 text-muted">{{ politika.aciklama }}</p>
                    </li>
                    {% else %}
                    <li class="list-group-item text-center text-muted">Henüz kalite politikası eklenmedi</li>
                    {% endfor %}
                </ul>
            `;
                break;

            case 'ekosistem':
                container.innerHTML = `
                <div class="ecosystem-container">
                    <div class="text-center mb-4">
                        <h3 class="ecosystem-main-title">
                            <i class="fas fa-sitemap text-primary me-3"></i>
                            Kuruluşun Ekosistemi
                        </h3>
                        <p class="text-muted">Kuruluşunuzun iç ve dış çevresini, paydaşlarını ve etkileşimlerini analiz edin</p>
                        
                        <!-- Kayıt ve Yükleme Butonları -->
                        <div class="ecosystem-controls mb-4">
                            <button class="btn btn-success me-2" onclick="saveEcosystemLayout()">
                                <i class="fas fa-save me-2"></i>Tasarımı Kaydet
                            </button>
                            <button class="btn btn-warning me-2" onclick="loadDefaultLayout()">
                                <i class="fas fa-undo me-2"></i>Varsayılanları Yükle
                            </button>
                            <button class="btn btn-info" onclick="resetEcosystemLayout()">
                                <i class="fas fa-refresh me-2"></i>Sıfırla
                            </button>
                        </div>
                    </div>
                    
        <!-- Ekosistem Haritası - Merkez ve Baİlantılar -->
        <div class="ecosystem-map-container">
            <div class="ecosystem-map">
                <!-- Küresel Çevre Halkası -->
                <div class="ecosystem-global-ring">
                    <div class="global-title">KÜRESEL ÇEVRE: KÜRESEL EİİLİMLER</div>
                    <div class="global-items">
                        <div class="global-item">Küresel Isınma</div>
                        <div class="global-item">Paylaşım Ekonomisi</div>
                        <div class="global-item">Demografik Çeşitlilik</div>
                        <div class="global-item">Yıkıcı Teknolojiler</div>
                        <div class="global-item">Jeopolitik Belirsizlik</div>
                        <div class="global-item">BM Sürdürülebilir Kalkınma Amaçları</div>
                        <div class="global-item">Toplumsal Eİilimler</div>
                        <div class="global-item">Ham Maddeler</div>
                    </div>
                </div>
                
                <!-- Pazar / Faaliyet Alanı Halkası -->
                <div class="ecosystem-market-ring">
                    <div class="market-title">PAZAR / FAALİYET ALANI</div>
                    <div class="market-items">
                        <div class="market-item">Aracılar</div>
                        <div class="market-item">Potansiyel Müşteriler</div>
                        <div class="market-item">Özel İlgi Grupları</div>
                        <div class="market-item">Yeni Girişimler</div>
                        <div class="market-item">Basın ve Sosyal Medya</div>
                        <div class="market-item">Rakipler</div>
                        <div class="market-item">Yenilikler</div>
                        <div class="market-item">Mevzuat</div>
                        <div class="market-item">İstihdam</div>
                    </div>
                </div>
                
                <!-- Paydaşlar Halkası -->
                <div class="ecosystem-stakeholders-ring">
                    <div class="stakeholders-title">PAYDAŞLAR</div>
                    <div class="stakeholders-items">
                        <div class="stakeholder-item">İşbirlikleri ve Tedarikçiler</div>
                        <div class="stakeholder-item">Kamu Kuruluşları</div>
                        <div class="stakeholder-item">Müşteriler</div>
                        <div class="stakeholder-item">Çalışanlar</div>
                        <div class="stakeholder-item">Hissedarlar</div>
                        <div class="stakeholder-item">Toplum</div>
                    </div>
                </div>
                
                <!-- Kuruluş Merkezi - Aktif Kuruluş -->
                <div class="ecosystem-center">
                    <div class="center-title">KURULUŞ</div>
                    <div class="center-content">
                        <div class="organization-name">{{ current_user.kurum.kisa_ad if current_user and current_user.kurum else 'Kuruluş Seçilmedi' }}</div>
                    </div>
                </div>
                
                <!-- Aşaİıya Doİru Baİlantı Kutuları -->
                <div class="ecosystem-connections">
                    <div class="connection-box management">
                        <div class="connection-title">Yönetim Yapısı</div>
                        <div class="connection-subtitle">(yönetişim, iş modeli, performans yönetimi)</div>
                    </div>
                    
                    <div class="connection-box leadership">
                        <div class="connection-title">Kurumsal Liderlik</div>
                    </div>
                    
                    <div class="connection-box purpose">
                        <div class="connection-title">Amaç</div>
                    </div>
                    
                    <div class="connection-box strategy">
                        <div class="connection-title">Strateji</div>
                    </div>
                    
                    <div class="connection-box culture">
                        <div class="connection-title">Kültür</div>
                    </div>
                    
                    <div class="connection-box performance">
                        <div class="connection-title">Performans ve Dönüşümü Yönlendirme</div>
                        <div class="connection-subtitle">(Varlıklar ve riskler dahil)</div>
                    </div>
                </div>
            </div>
                    </div>
                </div>
            `;
                // Sürükle-bırak özelliİini başlat
                setTimeout(() => {
                    initializeEcosystemDragDrop();
                }, 100);
                break;

            case 'vizyon':
                container.innerHTML = `
                <div class="card">
                    <div class="card-body">
                        {% if vizyon %}
                        <p class="lead">{{ vizyon }}</p>
                        {% else %}
                        <p class="text-muted text-center py-4">Henüz vizyon tanımlanmadı</p>
                        {% endif %}
                    </div>
                </div>
            `;
                break;

            case 'anaStratejiler':
                container.innerHTML = `
                <ul class="list-group">
                    {% for strateji in ana_stratejiler %}
                    <li class="list-group-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">{{ strateji.ad }}</h6>
                                <p class="mb-1 text-muted">{{ strateji.aciklama }}</p>
                                <small class="text-muted">
                                    <i class="fas fa-stream me-1"></i>
                                    {{ strateji.alt_stratejiler|length }} Alt Strateji
                                </small>
                            </div>
                        </div>
                    </li>
                    {% else %}
                    <li class="list-group-item text-center text-muted">Henüz ana strateji eklenmedi</li>
                    {% endfor %}
                </ul>
            `;
                break;

            case 'altStratejiler':
                container.innerHTML = `
                <ul class="list-group">
                    {% for alt in alt_stratejiler %}
                    <li class="list-group-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">{{ alt.ad }}</h6>
                                <p class="mb-1 text-muted">{{ alt.aciklama }}</p>
                                <small class="text-muted">
                                    <i class="fas fa-sitemap me-1"></i>
                                    Ana Strateji: {{ alt.ana_strateji.ad }}
                                </small>
                            </div>
                        </div>
                    </li>
                    {% else %}
                    <li class="list-group-item text-center text-muted">Henüz alt strateji eklenmedi</li>
                    {% endfor %}
                </ul>
            `;
                break;

            default:
                container.innerHTML = '<p class="text-center text-muted py-4">Bu bölüm henüz hazırlanmadı</p>';
        }
    }

    // ==========================================
    // FONKSİYONLARI GLOBAL SCOPE'A EXPOSE ET
    // ==========================================
    // Bu satırlar DOMContentLoaded içinde ama fonksiyonlar tanımlandıktan hemen sonra
    // böylece inline onclick handler'lar bunlara erişebilirwindow.loadModalContent = loadModalContent;
    // Diğer fonksiyonlar aşağıda tanımlanacak, onları da sonra ekleyeceğiz

    // ==========================================
    // CANLI YENİLEME FONKSİYONLARI
    // ==========================================

    let autoRefreshInterval = null;
    let lastGüncelleSaatstamp = new Date();

    // Sayfa yüklendiİinde otomatik yenilemeyi başlat
    document.addEventListener('DOMContentLoaded', function () {
        console.log('Stratejik Planlama Akışı sayfası yüklendi');

        // Modal butonlarına event listener ekle (onclick'in yanında)
        const saveBtn = document.querySelector('.edit-modal-btn-save');
        if (saveBtn) {
            console.log('Kaydet butonuna event listener ekleniyor...');
            saveBtn.addEventListener('click', function (e) {
                console.log('KAYDET BUTONU TIKLANDI! (addEventListener)');
                e.preventDefault();
                e.stopPropagation();
                saveDüzenleModal();
            });
        } else {
            console.warn('Kaydet butonu bulunamadı!');
        }

        try {
            updateLastGüncelleSaat();
        } catch (error) {
            console.warn('updateLastGüncelleSaat hatası:', error);
        }

        // Otomatik yenileme checkbox'ı dinle
        const autoRefreshToggle = document.getElementById('autoRefreshToggle');
        if (autoRefreshToggle) {
            autoRefreshToggle.addEventListener('change', function () {
                if (this.checked) {
                    startAutoRefresh();
                } else {
                    stopAutoRefresh();
                }
            });

            // Başlangıçta aktifse başlat
            if (autoRefreshToggle.checked) {
                startAutoRefresh();
            }
        }

        // LocalStorage deİişikliklerini dinle (diİer sekmelerden gelen güncellemeler)
        setupStorageListener();
    });

    // Otomatik yenilemeyi başlat
    function startAutoRefresh() {
        console.log('Otomatik yenileme başlatıldı (30 saniye)');

        // Önce mevcut interval'i temizle
        if (autoRefreshInterval) {
            clearInterval(autoRefreshInterval);
        }

        // Otomatik yenileme kaldırıldı - kullanıcı deİişikliklerini kaybetmemesi için
    }

    // Otomatik yenilemeyi durdur
    function stopAutoRefresh() {
        console.log('Otomatik yenileme durduruldu');
        if (autoRefreshInterval) {
            clearInterval(autoRefreshInterval);
            autoRefreshInterval = null;
        }
    }

    // Sayfayı yenile (AJAX ile)
    function refreshPageData() {
        const refreshBtn = document.getElementById('refreshBtn');
        const refreshIcon = document.getElementById('refreshIcon');

        // Butonu devre dışı bırak ve animasyon başlat
        if (refreshBtn) {
            refreshBtn.disabled = true;
            refreshIcon.classList.add('fa-spin');
        }

        console.log('Sayfa verileri yenileniyor...');

        // AJAX ile sayfayı yeniden yükle
        fetch(window.location.href, {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Sayfa yenilenemedi');
                }
                return response.text();
            })
            .then(html => {
                // Sayfayı tamamen yenile (en basit yöntem)
                console.log('Sayfa başarıyla yenilendi');
                window.location.reload();
            })
            .catch(error => {
                console.error('Yenileme hatası:', error);

                // Hata durumunda toast göster
                showToast('error', 'Sayfa yenilenemedi. Lütfen tekrar deneyin.');

                // Butonu tekrar aktif et
                if (refreshBtn) {
                    refreshBtn.disabled = false;
                    refreshIcon.classList.remove('fa-spin');
                }
            });
    }

    // Son güncelleme zamanını göster
    function updateLastGüncelleSaat() {
        const lastGüncelleElement = document.getElementById('lastGüncelleSaat');
        if (lastGüncelleElement) {
            const now = new Tarih();
            const timeString = now.toLocaleSaatString('tr-TR', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            lastGüncelleElement.innerHTML = `<i class="fas fa-clock me-1"></i>Son güncelleme: ${timeString}`;
        }
    }

    // Sayfa görünürlük deİişikliklerini dinle
    document.addEventListener('visibilitychange', function () {
        if (document.hidden) {
            // Sayfa arka planda, otomatik yenilemeyi durdur
            console.log('Sayfa arka plana alındı, otomatik yenileme durduruluyor');
            stopAutoRefresh();
        } else {
            // Sayfa tekrar aktif, otomatik yenileme ayarını kontrol et
            console.log('Sayfa tekrar aktif oldu');
            const autoRefreshToggle = document.getElementById('autoRefreshToggle');
            if (autoRefreshToggle && autoRefreshToggle.checked) {
                console.log('Otomatik yenileme yeniden başlatılıyor');
                refreshPageData(); // Hemen bir kez yenile
                startAutoRefresh();
            }
        }
    });

    // Sayfa kapatılırken interval'i temizle
    window.addEventListener('beforeunload', function () {
        stopAutoRefresh();
    });

    // ==========================================
    // LOCALSTORAGE DİNLEYİCİSİ (DİİER SEKMELER İÇİN)
    // ==========================================

    /**
     * LocalStorage deİişikliklerini dinle
     * Kurum panelinden veri kaydedildiİinde otomatik yenile
     */
       ctio     upStorageListener() {
        // stora     ent sadece diİer sekmelerden gelir (aynı sekme için çalı     
        window.addEventListener('storage', function (e) {
            console.log('Storage event algılandı:', e.key, e.newValue);

            if (e.key === 'sp_data_updated' && e.newValue) {
                try {
                    const updateData = JSON.parse(e.newValue);
                    console.log('Kurum panelinden güncelleme geldi:', updateData);

                    // Bildirim göster
                    showGüncelleNotification(updateData);

                    // Otomatik yenile (2 saniye sonra)
                    setTimeout(() => {
                        console.log('Otomatik yenileme başlatılıyor...');
                        refreshPageData();
                    }, 2000);

                } catch (error) {
                    console.error('Storage data parse hatası:', error);
                }
            }
        });

        console.log('LocalStorage dinleyicisi kuruldu');
    }

    /**
     * Güncelleme bildirimi göster
     */
    function showGüncelleNotification(updateData) {
        // Toast ben     bil      oluştur
        const notific      = document.createElement('div');
        notification.className = 'alert alert-info alert-dismissible fade show position-fixed';
        notification.style.cssText = 'top: 80px; right: 20px; z-index: 9999; min-width: 300px;';
        notification.innerHTML = `
        <i class="fas fa-sync-alt fa-spin me-2"></i>
        <strong>Yeni güncelleme!</strong><br>
        <small>${updateData.message || 'Veriler güncellendi'}</small>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;

        document.body.appendChild(notification);

        // 5 saniye sonra otomatik kapat
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 5000);
    }

    /**
     * Ekleme modalını göster
     */
    function showEkleModal(type, categor    
        // Modal ID'si
           st modalId = 'genericAddModal';
        let modal = document.getElementById(modalId);

        // Başlık belirle
        let title = 'Yeni Öğe Ekle';
        title = 'Yeni Öğe Ekle';

        // Modal HTML (eğer yoksa oluştur)
        if (!modal) {
           const mod
    alHtml = `
            <div class="modal fade" id="${modalId}" tabindex="-1" aria-hidden="true" style="z-index: 10000;">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content premium-dark">
                        <div class="modal-header">
                            <h5 class="modal-title text-white" id="${modalId}Title">Yeni Ekle</h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Kapat"></button>
                        </div>
                        <div class="modal-body">
                            <form id="${modalId}Form">
                                <input type="hidden" id="${modalId}Type">
                                <input type="hidden" id="${modalId}Category">
                                <div class="mb-3">
                                    <label for="${modalId}Text" class="form-label text-white-50">İçerik</label>
                                    <textarea class="form-control bg-dark text-white border-secondary" id="${modalId}Text" rows="4" required></textarea>
                                </div>
                            <    m>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                            <button type="button" class="btn btn-primary btn-premium-primary" onclick="saveNewGenericItem()">Ekle</button>
                        </div>
                    </div>
                </div>
            </div>`;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            modal = document.getElementById(modalId);
        }

        // Değerleri set et
        document.getElementById(`${modalId}Title`).textContent = title;
        document.getElementById(`${modalId}Type`).value = type;
        document.getElementById(`${modalId}Category`).value = category;
        document.getElementById(`${modalId}Text`).value = '';

        // Göster
        const bsModal = new bootstrap.Modal(modal);
        bsModal.show();
    }

    /**
     * Düzenleme modalını göster
     */
    function showDüzenleModal(type, category, id, currentText) {
        const modalId = 'genericEditModal';
        let modal = document.getElementById(modalId);

        let title = 'Öğe Düzenle';

        if (!modal) {
            const modalHtml = `
            <div class="modal fade" id="${modalId}" tabindex="-1" aria-hidden="true" style="z-index: 10000;">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content premium-dark">
                        <div class="modal-header">
                            <h5 class="modal-title text-white" id="${modalId}Title">Düzenle</h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Kapat"></button>
                        </div>
                        <div class="modal-body">
                            <form id="${modalId}Form">
                                <input type="hidden" id="${modalId}Type">
                                <input type="hidden" id="${modalId}Category">
                                <input type="hidden" id="${modalId}Id">
                                <div class="mb-3">
                                    <label for="${modalId}Text" class="form-label text-white-50">İçerik</label>
                                    <textarea class="form-control bg-dark text-white border-secondary" id="${modalId}Text" rows="4" required></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <butt    ype=     on" class="btn btn-secondary     a-bs-dismiss="modal">İptal</button>
                            <button type="button" class="btn btn-primary btn-premium-primary" onclick="updateGenericItem()">Güncelle</button>
                        </div>
                    </div>
                </div>
            </div>`;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            modal = document.getElementById(modalId);
        }

        document.getElementById(`${modalId}Title`).textContent = title;
        document.getElementById(`${modalId}Type`).value = type;
        document.getElementById(`${modalId}Category`).value = category;
        document.getElementById(`${modalId}Id`).value = id;
        document.getElementById(`${modalId}Text`).value = currentText;

        const bsModal = new bootstrap.Modal(modal);
        bsModal.show();
    }

    /**
     * Yeni öğeyi kaydet (Generic)
     */
    function saveNewGenericItem() {
        const modalId = 'genericAddModal';
        const type = document.getElementById(`${modalId}Type`).value;
        const category = document.getElementById(`${modalId}Category`).value;
        const text = document.getElementById(`${modalId}Text`).value;

        if (!text.trim()) {
            showToast('warning', 'Lütfen içerik giriniz.');
            return;
        }

        const container = document.getElementById(`${category}-content`);
        if (container) {
            const newId = Date.now();
            let newItem;

            showToast('warning', 'Bu işlem devre dışı.');
            return;
        }
    }

    /**
    * Öğeyi güncelle (Generic)
    */
    function updateGenericItem() {
        const modalId = 'genericEditModal';
        const type = document.getElementById(`${modalId}Type`).value;
        const category = document.getElementById(`${modalId}Category`).value;
        const id = document.getElementById(`${modalId}Id`).value;
        const text = document.getElementById(`${modalId}Text`).value;

        if (!text.trim()) return;

        // DOM'daki öğeyi bul ve güncelle
        const item = document.querySelector(`[data-category="${category}"][data-id="${id}"]`);
        if (item) {
            const textEl = item.querySelector('.item-text');
            if (textEl) {
                textEl.textContent = text;
                const modalEl = document.getElementById(modalId);
                const modal = bootstrap.Modal.getInstance(modalEl);
                modal.hide();
                showToast('success', 'Öğe güncellendi.');
            }
        }
    }

    /**
     * Toast bildirimi göster
     */
    function showToast(type, message) {
        // Bootstrap toast kullan
        const toastContainer = document.getElementById('toast-container') || createToastContainer();

        const toastId = 'toast-' + Date.now();
        const toastHtml = `
        <div class="toast" id="${toastId}" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header bg-${type === 'error' ? 'danger' : type} text-white">
                <i class="fas fa-${getToastIcon(type)} me-2"></i>
                <strong class="me-auto">${getToastBaşlık(type)}</strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body">
                ${message}
            </div>
        </div>
    `;

        toastContainer.insertAdjacentHTML('beforeend', toastHtml);

        const toastElement = document.getElementById(toastId);
        const toast = new bootstrap.Toast(toastElement, {
            autohide: true,
            delay: 3000
        });

        toast.show();

        // Toast kapandıktan sonra DOM'dan kaldır
        toastElement.addEventListener('hidden.bs.toast', () => {
            toastElement.remove();
        });
    }

    /**
     * Toast container oluştur
     */
    function createToastContainer() {
        const container = document.createElement('div');
        container.id = 'toast-container';
        container.className = 'toast-container position-fixed top-0 end-0 p-3';
        container.style.zIndex = '9999';
        document.body.appendChild(container);
        return container;
    }

    /**
     * Toast ikonu döndür
     */
    function getToastIcon(type) {
        const icons = {
            's    ss':     ck-circle',
            '     ': 'exclamation-circle',
            'warning': 'exclamation-triangle',
            'info': 'info-circle'
        return icons[type] || 'info-circle';
    }

    /**
     * Toast başlıİı döndür
     */
    function getToastBaşlık(type) {
        const titles = {
            'success': 'Başarılı',
            'error': 'Hata',
            'warning': 'Uyarı',
            'info': 'Bilgi'
        return titles[type] || 'Bilgi';
    }

    // ==========================================
    // EKOSİSTEM FONKSİYONLARI
    // =======================================    
             * Ekosistem verilerini yükle
     */
    functio     dEcosystemData() {
        console.log('Ekosistem verileri yükleniyor...');

        // Örnek verileri yükle
        loadSampleEcosystemData();
    }

    /**
     * Zoom In fonksiyonu
     */
    function zoomIn() {
        const container = document.getElementById('ecosystemMapContainer');
        if (container) {
            const currentScale = parseFloat(container.style.transform.replace('scale(', '').replace(')', '')) || 1;
            const newScale = Math.min(currentScale * 1.2, 3);
            container.style.transform = `scale(${newScale})`;
              }

    /**
     * Zoom Out fonksiyonu
     */
    fu     n zoomOut() {
        const container = document.getElementById('ecosystemMapContainer');
        if (container) {
            const currentScale = parseFloat(container.style.transform.replace('scale(', '').replace(')', '')) || 1;
            const newScale = Math.max(currentScale / 1.2, 0.5);
            container.style.transform = `scale(${newScale})`;
        }
    }

    /**
     * Zoom Reset fonksiyonu
     */
    function resetZoom() {
        const container = document.getElementById('ecosystemMapContainer');
           (con     r) {
            container.style.transform = 'scale(1            }
    }

    /**
     * Örnek ekosistem verilerini yükle
     */
    function loadSampleEcosystemData() {
        const sampleData = {
            'globalEnvironment': [
                { id: 1, text: 'Küresel ısınma' },
                { id: 2, text: 'Dijital dönüşüm' },
                { id: 3, text: 'Sürdürülebilirlik' }
            ],
            'marketActivity': [
                { id: 1, text: 'Rekabet ortamı' },
                { id: 2, text: 'Teknoloji trendleri' },
                { id: 3, text: 'Pazar büyümesi' }
            ],
            'stakeholders': [
                { id: 1, text: 'Müşteriler' },
                { id: 2, text: 'Çalışanla    ,
                { id: 3, text: 'Hiss     ar' },
                { id: 4, text: 'Tedarikçiler' }
            ],
            'organization': [
                { id: 1, text: 'Kurumsal deİerler' },
                    : 2,     : 'İş modeli' },
                { id: 3, text: 'Yetenekler' }
            ],
            'challenges': [
                { id: 1, text: 'Rekabet baskısı' },
                { id: 2, text: 'Teknoloji deİişimi' }
            ],
            'valueCreation': [
                { id: 1, text: 'Sürdürülebilir büyüme' },
                { id: 2, text: 'Değer yaratma' }
            ],
            'leadership': [
                { id: 1, text: 'Liderl     tkinlikleri' },
                { id: 2, text: 'Yönetim becerileri' }
            ],
            'performance': [
                { id: 1, text: 'KPI\'lar' },
                { id: 2, text: 'Performans göstergeleri' }
            ],
            'management': [
                { id: 1, text: 'Yönetim yapısı' },
                { id: 2, text: 'İş modeli' }
            ],
            'pur    ': [                 { id: 1, tex     isyon' },
                { id: 2, text: 'Vizyon' }
            ],
            'strategy': [
                { id: 1, text: 'Stratejik hedefler' },
                { id: 2, text: 'Rekabet stratejisi'               ],
            'culture': [
                { id: 1, text: 'Kurumsal kültür' },
                { id: 2, text: 'Değerler' }
            ]

        // Her kategori için verileri yükle
        Object.keys(sampleData).forEach(category => {
            // Harita içeriİi
            const mapContainer = document.getElementById(`${category}Items`);
            if (mapContainer) {
                mapContainer.innerHTML = '';
                sampleData[category].forEach(item => {
                    const ecosystemItem = createEcosystemItem(item.id, item.text, category);
                    mapContainer.appendChild(ecosystemItem);
                });
            }

            // Veri girişi içeriİi
            const inputContainer = document.getElementById(`${category}Input`);
            if (inputContainer) {
                inputContainer.innerHTML = '';
                sampleData[category].forEach(item => {
                    const ecosystemItem = createEcosystemItem(item.id, item.text, category);
                    inputContainer.appendChild(ecosystemItem);
                });
            }
        });

        // Haritayı güncelle
        updateEcosystemMap();
    }

    /**
     * Ekosistem öİesi oluştur
     */
    function createEcosystemItem(id, text, category) {
        const item = document.createElement('div');
        item.className = `ecosystem-item ${category}`;
        item.setAttribute('data-id', id);
        item.setAttribute('data-category', category);

        item.innerHTML = `
        <div class="d-flex justify-content-between align-items-center">
            <span>${text}</span>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteEcosystemItem('${category}', ${id})" title="Sil">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    `;

        return item;
    }

    /**
     * Ekosistem öİesi ekle
     */
    function addEcosystemItem(category) {
        const categoryAds = {
            'globalEnvironment': 'Küresel Eİilim',
            'marketActivity': 'Pazar Faktörü',
            'stakeholders': 'Paydaş',
            'organization': 'Kuruluş Bilgisi',
            'challenges': 'Zorluk/Fırsat',
            'valueCreation': 'Değer Yaratma',
            'leadership': 'Liderlik',
            'performance': 'Performans',
            'management': 'Yönetim',
            'purpose': 'Amaç',
            'strategy': 'Strateji',
            'culture': 'Kültür'

        const text = prompt(`${categoryAds[category]} için yeni öİe ekleyin:`);
        if (text && text.trim()) {
            const newId = Date.now();
            const newItem = createEcosystemItem(newId, text.trim(), category);

            // Hem harita hem veri girişi bölümüne ekle
            const mapContainer = document.getElementById(`${category}Items`);
            const inputContainer = document.getElementById(`${category}Input`);

            if (mapContainer) {
                const mapItem = newItem.cloneNode(true);
                mapContainer.appendChild(mapItem);

                // Animasyon ekle
                mapItem.style.opacity = '0';
                mapItem.s    .tra     m = 'translateY(-20px)';
                setTimeout(() => {
                    mapItem.style.transition = 'all 0.3s ease';
                    mapItem.style.opacity = '1';
                    mapItem.style.transform = 'translateY(0)';
                }, 100);
            }

            if (inputContainer) {
                const inputItem = newItem.cloneNode(true);
                inputContainer.appendChild(inputItem);

                // Animasyon ekle
                inputItem.style.opacity = '0';
                inputItem.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    inputItem.style.transition = 'all 0.3s e    ;
                    inputItem.     .opacity = '1';
                    inputItem.style.transform = 'translateY(0)';
                }, 100);
            }

            // Haritayı görsel olarak güncelle
            updateEcosystemMap();

            showToast('success', `${categoryAds[category]} öİesi eklendi`);
        }
    }

    /**
     * Ekosistem haritasını görsel olarak güncelle
     */
    function updateEcosystemMap() {
        // Her katmanın veri sayısına göre görsel deİişiklikler
        const layers = [
            { id: 'globalEnvironmentLayer', category: 'globalEnvironment' },
            { id: 'marketActivityLayer', category: 'marketActivity' },
            { id: 'stakeholdersLayer', category: 'stakeholders' },
            { id: 'organizationCenter', category: 'organization' }
        ];

        layers.forEach(layer => {
            const layerElement = document.getElementById(layer.id);
            const itemsContainer = document.getElementById(`${layer.category}Items`);

            if (layerElement && itemsContainer) {
                const itemCount = itemsContainer.children.length;

                // Veri sayısına göre katman rengini deİiştir
                if (itemCount === 0) {
                    layerElement.style.opacity = '0.3';
                    layerElement.style.borderStyle = 'dashed';
                } else if (itemCount < 3) {
                    layerElement.style.opacity = '0.6';
                    layerElement.style.borderStyle = 'solid';
                } else {
                    layerElement.style.opacity = '1';
                    layerElement.style.borderStyle = 'solid';
                    layerElement.style.borderWidth = '4px';
                }
            }
        });

        // Baİlantı kutularını güncelle
        const connections = [
            'challenges', 'valueCreation', 'leadership', 'performance',
            'management', 'purpose', 'strategy', 'culture'
        ];

        connections.forEach(connection => {
            const boxElement = document.getElementById(`${connection}Box`);
            const itemsContainer = document.getElementById(`${connection}Items`);

            if (boxElement && itemsContainer) {
                const itemCount = itemsContainer.children.length;

                if (itemCount === 0)                       boxElement.style.opacity = '0.3';
                    boxElement.style.borderStyle = 'dashed';
                } else {
                    boxElement.style.opacity = '1';
                    boxElement.style.borderStyle = 'solid';
                }
            }
        });
    }

    /**
     * Ekosistem öİesini sil
     */
    function deleteEcosystemItem(category, itemId) {
        const item = document.querySelector(`[data-category="${category}"][data-id="${itemId}"]`);
        if (item) {
            const categoryAds = {
                'global-environment': 'Küresel Eİilim',
                'market-activity': 'Pazar Faktörü',
                'stakeholders': 'Paydaş',
                'organization': 'Kuruluş Bilgisi',
                'purpose': 'Amaç',
                'strategy': 'Strateji',
                'culture': 'Kültür',
                'performance': 'Performans'

            if (confirm(`${categoryAds[category]} öİesini silmek istediİinizden emin misiniz?`)) {
                // Animasyon ile sil
                item.style.transition = 'all 0.3s ease';
                item.style.opacity = '0';
                item.style.transform = 'translateX(-100px)';

                setTimeout(() => {
                    item.remove();
                    showToast('warning', `${categoryAds[category]} öİesi silindi`);
                }, 300);
            }
        }
    }

    /**
     * Ekosistem verilerini kaydet
     */
    function saveEcosystemData() {
        console.log('Ekosistem verileri kaydediliyor...');

        const ecosystemData = {
            'global-environment': [],
            'market-activity': [],
            'stakeholders': [],
            'organization': [],
            'purpose': [],
            'strategy': [],
            'culture': [],
            'performance': []

        // Her kategoriden verileri topla
        Object.keys(ecosystemData).forEach(category => {
            const items = document.querySelectorAll(`[data-category="${category}"]`);
            items.forEach(item => {
                const text = item.querySelector('span').textContent;
                const id = item.getAttribute('data-id');
                ecosystemData[category].push({ id: parseInt(id), text: text });
            });
                     // Verileri kayd     urada API çaİrısı yapılabilir)
        console.log('Ekosistem verileri:', ecosystemData);

        showToast('success', 'Ekosistem verileri başarıyla kaydedildi!');
    }

    // Sürükle-bırak fonksiyonları
    function makeEcosystemItemsDraggable() {
        const marketItems = document.querySelectorAll('.market-item');
        const stakeholderItems = document.querySelectorAll('.stakeholder-item');
        const globalItems = document.querySelectorAll('.global-item');
        const allItems = [...marketItems, ...stakeholderItems, ...globalItems];

        console.log('Bulunan market items:', marketItems.length);
        console.log('Bulunan stakeholder items:', stakeholderItems.length);
        console.log('Toplam items:', allItems.length);

        allItems.forEach((item, index) => {
            console.log(`Item ${index + 1}:`, item.textContent);

            let isDragging = false;
            let startX, startY, initialX, initialY;

            item.addEventListener('mousedown', (e) => {
                console.log('Mouse down on:', item.textContent);
                   ragg      true;
                item.cl     st.add('dragging');

                startX = e.clientX;
                startY = e.clientY;

                const rect = item.getBoundingClientRect();
                const containerRect = item.parentElement.getBoundingClientRect();

                initialX = rect.left - containerRect.left;
                initialY = rect.top - containerRect.top;

                e.preventDefault();
                e.stopPropagation();
            });

            const handleMouseMove = (e) => {
                if (!isDragging) return;

                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;

                const newX = initialX + deltaX;
                const newY = initialY + deltaY;

                // Halkanın içinde kalmasını saİla
                const containerWidth = item.parentElement.offsetWidth;
                const containerHeight = item.parentElement.offsetHeight;
                const itemWidth = item.offsetWidth;
                const itemHeight = item.offsetHeight;

                // Halka sınırları (oval şekil için)
                const centerX = containerWidth / 2;
                const centerY = containerHeight / 2;
                const radiusX = containerWidth / 2 - 20; // 20px margin
                const radiusY = containerHeight / 2 - 20;

                // Oval sınırları kontrol et
                const relativeX = newX + itemWidth / 2 - centerX;
                const relativeY = newY + itemHeight / 2 - centerY;

                const ellipseCheck = (relativeX * relativeX) / (radiusX * radiusX) +
                    (relativeY * relativeY) / (radiusY * radiusY);

                if (ellipseCheck <= 1) {
                    // Oval içinde, konumu güncelle
                    item.style.left = newX + 'px';
                    item.style.top = newY + 'px';
                    item.style.transform = 'none';
                }

            const handleMouseUp = () => {
                if (isDragging) {
                    console.log('Mouse up on:', item.textContent);
                    isDragging = false;
                    item.classList.remove('dragging');

                    // Yüzde deİerlerine çevir
                    const containerWidth = item.parentElement.offsetWidth;
                    const containerHeight = item.parentElement.offsetHeight;
                    const itemWidth = item.offsetWidth;
                    const itemHeight = item.offsetHeight;

                    const x = parseFloat(item.style.left);
                    const y = parseFloat(item.style.top);

                    const percentX = ((x + itemWidth / 2) / containerWidth) * 100;
                    const percentY = ((y + itemHeight / 2) / containerHeight) * 100;

                    item.style.left = percentX + '%';
                    item.style.top = percentY + '%';
                    item.style.transform = 'translate(-50%, -50%)';

                    // Event listener'ları kaldır
                    document.removeEventListener('mousemove', handleMouseMove);
                    document.removeEventListener('mouseup', handleMouseUp);
                }

            item.addEventListener('mousedown', (e) => {
                console.log('Mouse down on:', item.textContent);
                isDragging = true;
                item.classList.add('dragging');

                startX = e.clientX;
                startY = e.clientY;

                const rect = item.getBoundingClientRect();
                const containerRect = item.parentElement.getBoundingClientRect();

                initialX = rect.left - containerRect.left;
                initialY = rect.top - containerRect.top;

                e.preventDefault();
                e.stopPropagation();

                // Event listener'ları ekle
                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', handleMouseUp);
            });
        });
    }

    // Sayfa yüklendiİinde sürükle-bırak özelliİini etkinleştir
    document.addEventListener('DOMContentLoaded', function () {
        console.log('DOM loaded, initializing drag and drop...');
        makeEcosystemItemsDraggable();
    });

    // Ekosistem sekmesi açıldıİında da çalıştır
    function initializeEcosystemDragDrop() {
        console.log('Initializing ecosystem drag and drop...');
        setTimeout(() => {
            makeEcosystemItemsDraggable();
            loadKaydetdLayout(); // Kaydedilmiş düzeni yükle
        }, 100);
    }

    // Varsayılan düzen
    const defaultLayout = {
        global: {
            'Küresel Isınma': { top: '25%', left: '20%' },
            'Paylaşım Ekonomisi': { top: '45%', left: '15%' },
            'Demografik Çeşitlilik': { bottom: '35%', left: '20%' },
            'Yıkıcı Teknolojiler': { bottom: '25%', left: '50%' },
            'Jeopolitik Belirsizlik': { bottom: '35%', right: '20%' },
            'BM Sürdürülebilir Kalkınma Amaçları': { top: '45%', right: '15%' },
            'Toplumsal Eİilimler': { top: '25%', right: '20%' },
            'Ham Maddeler': { top: '20%', left: '50%' }
        },
        market: {
            'Aracılar': { top: '20%', right: '15%' },
            'Potansiyel Müşteriler': { top: '20%', left: '15%' },
            'Özel İlgi Grupları': { top: '50%', right: '10%' },
            'Yeni Girişimler': { top: '45%', left: '10%' },
            'Basın ve Sosyal Medya': { top: '60%', left: '15%' },
            'Rakipler': { bottom: '20%', left: '40%' },
            'Yenilikler': { bottom: '20%', left: '60%' },
            'Mevzuat': { bottom: '30%', left: '20%' },
            'İstihdam': { bottom: '25%', right: '20%' }
        },
        stakeholder: {
            'İşbirlikleri ve Tedarikçiler': { top: '20%', left: '20%' },
            'Kamu Kuruluşları': { top: '20%', right: '20%' },
            'Müşteriler': { top: '50%', right: '10%' },
            'Çalışanlar': { bottom: '30%', right: '20%' },
            'Hissedarlar': { bottom: '25%', left: '50%' },
            'Toplum': { bottom: '30%', left: '20%' }
        }

    // Düzeni kaydet
    function saveEcosystemLayout() {
        const layout = {
            market: {},
            stakeholder: {}

        // Market items
        document.querySelectorAll('.market-item').forEach(item => {
            const text = item.textContent.trim();
            const rect = item.getBoundingClientRect();
            const container = item.parentElement.getBoundingClientRect();

            const left = ((rect.left - container.left + rect.width / 2) / container.width) * 100;
            const top = ((rect.top - container.top + rect.height / 2) / container.height) * 100;

            layout.market[text] = { left: left + '%', top: top + '%' };
        });

        // Stakeholder items
        document.querySelectorAll('.stakeholder-item').forEach(item => {
            const text = item.textContent.trim();
            const rect = item.getBoundingClientRect();
            const container = item.parentElement.getBoundingClientRect();

            const left = ((rect.left - container.left + rect.width / 2) / container.width) * 100;
            const top = ((rect.top - container.top + rect.height / 2) / container.height) * 100;

            layout.stakeholder[text] = { left: left + '%', top: top + '%' };
        });

        localStorage.setItem('ecosystemLayout', JSON.stringify(layout));
        showToast('success', 'Ekosistem düzeni kaydedildi!');
    }

    // Kaydedilmiş düzeni yükle
    function loadKaydetdLayout() {
        const saved = localStorage.getItem('ecosystemLayout');
        if (saved) {
            const layout = JSON.parse(saved);
            applyLayout(layout);
        }
    }

    // Varsayılan düzeni yükle
    function loadDefaultLayout() {
        applyLayout(defaultLayout);
        showToast('info', 'Varsayılan düzen yüklendi!');
    }

    // Düzeni sıfırla
    function resetEcosystemLayout() {
        localStorage.removeItem('ecosystemLayout');
        loadDefaultLayout();
        showToast('warning', 'Düzen sıfırlandı!');
    }

    // Düzeni uygula
    function applyLayout(layout) {
        // Market items
        document.querySelectorAll('.market-item').forEach(item => {
            const text = item.textContent.trim();
            if (layout.market[text]) {
                const pos = layout.market[text];
                item.style.left = pos.left;
                item.style.top = pos.top;
                item.style.right = pos.right || 'auto';
                item.style.bottom = pos.bottom || 'auto';
                item.style.transform = 'translate(-50%, -50%)';
            }
        });

        // Stakeholder items
        document.querySelectorAll('.stakeholder-item').forEach(item => {
            const text = item.textContent.trim();
            if (layout.stakeholder[text]) {
                const pos = layout.stakeholder[text];
                item.style.left = pos.left;
                item.style.top = pos.top;
                item.style.right = pos.right || 'auto';
                item.style.bottom = pos.bottom || 'auto';
                item.style.transform = 'translate(-50%, -50%)';
            }
        });
    }

    // ==========================================
    // FONKSİYONLARI GLOBAL SCOPE'A EXPOSE ET (Dosya sonu)
    // ==========================================
    // Tüm fonksiyonları global scope'a ekle (inline onclick için)
    // NOT: Bu satırlar DOMContentLoaded içindeki satır 3814'te de var

    window.saveEcosystemLayout = saveEcosystemLayout;
    window.resetEcosystemLayout = resetEcosystemLayout;
    window.loadDefaultLayout = loadDefaultLayout;
    window.loadEcosystemData = loadEcosystemData;
    window.loadSampleEcosystemData = loadSampleEcosystemData;
    window.createEcosystemItem = createEcosystemItem;
    window.addEcosystemItem = addEcosystemItem;
    window.updateEcosystemMap = updateEcosystemMap;
    window.deleteEcosystemItem = deleteEcosystemItem;
    window.saveEcosystemData = saveEcosystemData;

</script>
{% endblock %}